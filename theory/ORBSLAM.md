# <center>orbslam notebook </center>
- [orbslam notebook ](#orbslam-notebook-)
  - [çŸ©é˜µçš„æ€§è´¨](#çŸ©é˜µçš„æ€§è´¨)
    - [ç‰¹å¾å€¼åˆ†è§£](#ç‰¹å¾å€¼åˆ†è§£)
    - [ç§©ä¸è‡ªç”±åº¦ï¼ˆ æ–¹é˜µA(n\*n) ï¼‰](#ç§©ä¸è‡ªç”±åº¦-æ–¹é˜µann-)
    - [é½æ¬¡çº¿æ€§æ–¹ç¨‹ç»„æ±‚è§£ï¼ˆç§©è¡¨ç¤ºå¯ä»¥åˆ—å‡ ä¸ªæ–¹ç¨‹ï¼‰](#é½æ¬¡çº¿æ€§æ–¹ç¨‹ç»„æ±‚è§£ç§©è¡¨ç¤ºå¯ä»¥åˆ—å‡ ä¸ªæ–¹ç¨‹)
    - [ç‰¹æ®ŠçŸ©é˜µçš„æ€§è´¨](#ç‰¹æ®ŠçŸ©é˜µçš„æ€§è´¨)
      - [ä¸€ï¼šä¸ºä»€ä¹ˆæœ¬è´¨çŸ©é˜µ(E)çš„ç§©ä¸º2ï¼Ÿ](#ä¸€ä¸ºä»€ä¹ˆæœ¬è´¨çŸ©é˜µeçš„ç§©ä¸º2)
      - [äºŒï¼šä¸ºä»€ä¹ˆåŸºç¡€çŸ©é˜µ(F)çš„ç§©ä¸º2](#äºŒä¸ºä»€ä¹ˆåŸºç¡€çŸ©é˜µfçš„ç§©ä¸º2)
      - [ä¸‰ï¼šä¸ºä»€ä¹ˆå°ºåº¦ç­‰ä»·æ€§è¦å‡å°‘ä¸€ä¸ªè‡ªç”±åº¦ï¼Ÿ](#ä¸‰ä¸ºä»€ä¹ˆå°ºåº¦ç­‰ä»·æ€§è¦å‡å°‘ä¸€ä¸ªè‡ªç”±åº¦)
      - [å››ï¼šä¸ºä»€ä¹ˆåŸºç¡€çŸ©é˜µè‡ªç”±åº¦æ˜¯7ï¼Ÿ](#å››ä¸ºä»€ä¹ˆåŸºç¡€çŸ©é˜µè‡ªç”±åº¦æ˜¯7)
      - [äº”ï¼šä¸ºä»€ä¹ˆæœ¬è´¨çŸ©é˜µè‡ªç”±åº¦æ˜¯5ï¼Ÿ](#äº”ä¸ºä»€ä¹ˆæœ¬è´¨çŸ©é˜µè‡ªç”±åº¦æ˜¯5)
      - [å…­ï¼šä¸ºä»€ä¹ˆå•åº”çŸ©é˜µè‡ªç”±åº¦æ˜¯8ï¼Ÿ](#å…­ä¸ºä»€ä¹ˆå•åº”çŸ©é˜µè‡ªç”±åº¦æ˜¯8)
  - [åŸºç¡€çŸ©é˜µ](#åŸºç¡€çŸ©é˜µ)
    - [å¯¹æå‡ ä½•](#å¯¹æå‡ ä½•)
    - [è®¡ç®—åŸºç¡€çŸ©é˜µ](#è®¡ç®—åŸºç¡€çŸ©é˜µ)
      - [å½’ä¸€åŒ–8ç‚¹æ³•](#å½’ä¸€åŒ–8ç‚¹æ³•)
        - [ç®—æ³•æ­¥éª¤](#ç®—æ³•æ­¥éª¤)
        - [å¯¹ç‰¹å¾ç‚¹å½’ä¸€åŒ–å˜æ¢](#å¯¹ç‰¹å¾ç‚¹å½’ä¸€åŒ–å˜æ¢)
        - [æ±‚è§£åŸºç¡€çŸ©é˜µFï¼Œæ­¥éª¤åœ¨8ç‚¹æ³•é‡Œ](#æ±‚è§£åŸºç¡€çŸ©é˜µfæ­¥éª¤åœ¨8ç‚¹æ³•é‡Œ)
        - [è§£é™¤å½’ä¸€åŒ–](#è§£é™¤å½’ä¸€åŒ–)
    - [åŸºç¡€çŸ©é˜µçš„åˆ†è§£](#åŸºç¡€çŸ©é˜µçš„åˆ†è§£)
    - [æ£€æŸ¥Rå’Œt](#æ£€æŸ¥rå’Œt)
      - [æ£€æŸ¥3Dç‚¹å’Œä¸¤ä¸ªç›¸æœºçš„è§†å·®](#æ£€æŸ¥3dç‚¹å’Œä¸¤ä¸ªç›¸æœºçš„è§†å·®)
      - [æ£€æŸ¥3Dç‚¹çš„æ·±åº¦](#æ£€æŸ¥3dç‚¹çš„æ·±åº¦)
      - [æ£€æŸ¥3Dç‚¹åœ¨ä¸¤ä¸ªç›¸æœºçš„é‡æŠ•å½±è¯¯å·®](#æ£€æŸ¥3dç‚¹åœ¨ä¸¤ä¸ªç›¸æœºçš„é‡æŠ•å½±è¯¯å·®)
  - [å•åº”çŸ©é˜µ](#å•åº”çŸ©é˜µ)
    - [è®¡ç®—å•åº”çŸ©é˜µ](#è®¡ç®—å•åº”çŸ©é˜µ)
    - [å•åº”çŸ©é˜µçš„åˆ†è§£](#å•åº”çŸ©é˜µçš„åˆ†è§£)
  - [ä¸‰è§’æµ‹é‡åŸç†](#ä¸‰è§’æµ‹é‡åŸç†)
  - [PnPé—®é¢˜](#pnpé—®é¢˜)
  - [é‡æŠ•å½±è¯¯å·®ä¸BAä¼˜åŒ–å‡½æ•°](#é‡æŠ•å½±è¯¯å·®ä¸baä¼˜åŒ–å‡½æ•°)
    - [é‡æŠ•å½±è¯¯å·®](#é‡æŠ•å½±è¯¯å·®)
    - [BAä¼˜åŒ–](#baä¼˜åŒ–)
      - [ç¨€ç–æ€§å’Œè¾¹ç¼˜åŒ–](#ç¨€ç–æ€§å’Œè¾¹ç¼˜åŒ–)
      - [é²æ£’æ ¸å‡½æ•°](#é²æ£’æ ¸å‡½æ•°)
      - [ä¼˜åŒ–å®è·µ](#ä¼˜åŒ–å®è·µ)
      - [é«˜æ–¯ç‰›é¡¿æ³•](#é«˜æ–¯ç‰›é¡¿æ³•)

![alt text](./orbslam_images/image-4.png)

## çŸ©é˜µçš„æ€§è´¨

**ï¼ˆ1ï¼‰æ­£äº¤çŸ©é˜µç›¸ä¹˜ä»ç„¶æ˜¯æ­£äº¤çŸ©é˜µ**  

**ï¼ˆ2ï¼‰ä¸€ä¸ªçŸ©é˜µä¹˜ä»¥æ­£äº¤çŸ©é˜µï¼ŒèŒƒæ•°ä¸å˜**ï¼ˆä¿èŒƒæ€§ï¼‰ 

**ï¼ˆ3ï¼‰ä¸€ä¸ªçŸ©é˜µä¹˜ä»¥å¯é€†çŸ©é˜µç§©ä¸å˜** 

**ï¼ˆ4ï¼‰åˆç­‰å˜æ¢åªæ˜¯ä¸å½±å“çŸ©é˜µçš„ç§©ï¼Œå…¶ä»–çš„ç‰¹æ€§éƒ½æ”¹å˜äº†ã€‚å¯¹äºè®¡ç®—çŸ©é˜µçš„è¡Œåˆ—å¼ï¼Œä¸èƒ½è¿›è¡Œåˆç­‰å˜æ¢ï¼Œä½†æ˜¯å¯ä»¥åšè¡Œåˆ—çš„è¿›åŠ å‡ï¼Œä¸èƒ½ä¹˜ä»¥ç³»æ•°ã€‚** 

**ï¼ˆ5ï¼‰çŸ©é˜µçš„è¿¹ï¼šçŸ©é˜µçš„ä¸»å¯¹è§’çº¿ä¸Šå„ä¸ªå…ƒç´ çš„æ€»å’Œï¼Œæ˜¯çŸ©é˜µæ‰€æœ‰ç‰¹å¾å€¼çš„å’Œ** 

**ï¼ˆ6ï¼‰å¯¹è§’çŸ©é˜µçš„ç‰¹å¾å€¼æ˜¯å…¶å¯¹è§’çº¿ä¸Šçš„å„ä¸ªå…ƒç´ ** 

**ï¼ˆ7ï¼‰çŸ©é˜µçš„ç§©ç­‰äºéé›¶å¥‡å¼‚å€¼çš„ä¸ªæ•°ï¼Œç­‰äºéé›¶ç‰¹å¾å€¼çš„ä¸ªæ•°** 

**ï¼ˆ8ï¼‰ä»»æ„çŸ©é˜µéƒ½èƒ½è¿›è¡Œå¥‡å¼‚å€¼åˆ†è§£ï¼Œåªæœ‰æ–¹é˜µæ‰å¯ä»¥è¿›è¡Œç‰¹å¾å€¼åˆ†è§£** 

### ç‰¹å¾å€¼åˆ†è§£
å¦‚æœä¸€ä¸ªå‘é‡ *v* æ˜¯æ–¹é˜µ *A*çš„ç‰¹å¾å‘é‡ï¼Œå°†å¯ä»¥è¡¨ç¤ºæˆä¸‹é¢çš„å½¢å¼ï¼š *Av= Î»v*ï¼Œ*Î»* ç§°ä¸ºç‰¹å¾å‘é‡ *v* å¯¹åº”çš„ç‰¹å¾å€¼ï¼Œå¹¶ä¸”ä¸€ä¸ªçŸ©é˜µçš„ä¸€ç»„ç‰¹å¾å‘é‡æ˜¯ä¸€ç»„æ­£äº¤å‘é‡ã€‚ 
ç‰¹å¾å€¼åˆ†è§£ï¼š**Q**æ˜¯è¿™ä¸ªçŸ©é˜µAçš„ç‰¹å¾å‘é‡ç»„æˆçš„çŸ©é˜µï¼Œ**Î£**æ˜¯ä¸€ä¸ªå¯¹è§’é˜µï¼Œæ¯ä¸€ä¸ªå¯¹è§’çº¿ä¸Šçš„å…ƒç´ å°±æ˜¯ä¸€ä¸ªç‰¹å¾å€¼
$A = Q{\Sigma}Q^{-1}$
å¥‡å¼‚å€¼åˆ†è§£SVDï¼š
å‡è®¾*A*æ˜¯ä¸€ä¸ªN * Mçš„çŸ©é˜µï¼Œ*U*æ˜¯ä¸€ä¸ªN * Nçš„æ–¹é˜µï¼ˆæ­£äº¤çŸ©é˜µï¼‰ï¼Œ*Î£* æ˜¯ä¸€ä¸ªN * Mçš„çŸ©é˜µï¼ˆå¯¹è§’çº¿ä¸Šçš„å…ƒç´ ä¸ºå¥‡å¼‚å€¼ï¼‰ï¼Œ$V^{T}$æ˜¯ä¸€ä¸ªM * Mçš„çŸ©é˜µï¼ˆæ­£äº¤çŸ©é˜µï¼‰ 
$A = U{\Sigma}V^{T}$
ç‰¹å¾å€¼å’Œå¥‡å¼‚å€¼çš„å…³ç³»ï¼š
![](./orbslam_images/GetImage26.png)
ï¼ˆ1ï¼‰*U*çš„åˆ—å‘é‡ï¼Œæ˜¯ $AA^T$çš„ç‰¹å¾å‘é‡ï¼› 
ï¼ˆ2ï¼‰*V*çš„åˆ—å‘é‡ï¼Œæ˜¯ $A^{T}A$ çš„ç‰¹å¾å‘é‡ï¼› 
ï¼ˆ3ï¼‰*A*çš„å¥‡å¼‚å€¼ï¼ˆ*Î£*çš„éé›¶å¯¹è§’å…ƒç´ ï¼‰åˆ™æ˜¯ $AA^T$ æˆ–è€… $A^{T}A$  çš„éé›¶ç‰¹å¾å€¼çš„å¹³æ–¹æ ¹ã€‚ 

### ç§©ä¸è‡ªç”±åº¦ï¼ˆ æ–¹é˜µA(n\*n) ï¼‰
çŸ©é˜µçš„ç§©ï¼ŒæŒ‡çš„æ˜¯ç»è¿‡åˆç­‰å˜æ¢ä¹‹åçš„éé›¶è¡Œï¼ˆåˆ—ï¼‰çš„ä¸ªæ•°ï¼Œè‹¥ä¸å­˜åœ¨é›¶è¡Œï¼ˆåˆ—ï¼‰ï¼Œåˆ™ä¸ºæ»¡ç§©çŸ©é˜µï¼ˆRank(A)=nï¼›å…³äºçŸ©é˜µçš„ç§©çš„å¦ä¸€ç§ç†è§£ï¼šAçŸ©é˜µå°†nç»´ç©ºé—´ä¸­çš„å‘é‡æ˜ å°„åˆ°kï¼ˆk<=nï¼‰ç»´ç©ºé—´ä¸­ï¼Œk=Rank(A) 
çŸ©é˜µï¼ˆå‚æ•°çŸ©é˜µï¼‰çš„è‡ªç”±åº¦ï¼ŒæŒ‡çš„æ˜¯è¦æƒ³æ±‚è§£å‡ºçŸ©é˜µçš„æ‰€æœ‰å…ƒç´ è‡³å°‘éœ€è¦åˆ—å‡ ä¸ªçº¿æ€§æ–¹ç¨‹ç»„ã€‚è‹¥çŸ©é˜µæœ¬èº«å¸¦æœ‰ x ä¸ªçº¦æŸï¼Œåˆ™åªéœ€è¦åˆ—n*n-xä¸ªæ–¹ç¨‹ç»„å³å¯æ±‚å‡ºæ‰€æœ‰å‚æ•°ï¼Œå³çŸ©é˜µAçš„è‡ªç”±åº¦ä¸ºn*n-xã€‚ 

### é½æ¬¡çº¿æ€§æ–¹ç¨‹ç»„æ±‚è§£ï¼ˆç§©è¡¨ç¤ºå¯ä»¥åˆ—å‡ ä¸ªæ–¹ç¨‹ï¼‰
1.r(A)=æœªçŸ¥æ•°ä¸ªæ•°nï¼ˆçº¦æŸè¾ƒå¼ºï¼‰ 
è¯¥è§£ç©ºé—´åªå«æœ‰é›¶å‘é‡ 
2.r(A)<æœªçŸ¥æ•°ä¸ªæ•°nï¼ˆçº¦æŸä¸å¤Ÿï¼‰ 
ç”±é½æ¬¡çº¿æ€§æ–¹ç¨‹ç»„è§£ç©ºé—´ç»´æ•° = n - r(A) >0ï¼Œæ‰€ä»¥è¯¥é½æ¬¡çº¿æ€§æ–¹ç¨‹ç»„æœ‰éé›¶è§£ï¼Œè€Œä¸”ä¸å”¯ä¸€ï¼Œå­˜åœ¨ä¸€ä¸ªåŸºç¡€è§£ç³»ï¼ˆåŸºç¡€è§£ç³»ä¸­çš„å‘é‡ä¸ªæ•°ä¸º n - r(A)ä¸ª)ã€‚ 

### ç‰¹æ®ŠçŸ©é˜µçš„æ€§è´¨

#### ä¸€ï¼šä¸ºä»€ä¹ˆæœ¬è´¨çŸ©é˜µ(E)çš„ç§©ä¸º2ï¼Ÿ
ï¼ˆ1ï¼‰å› ä¸ºä¸€ä¸ªçŸ©é˜µä¹˜ä»¥å¯é€†çŸ©é˜µç§©ä¸å˜ï¼Œå› ä¸ºå¯é€†çŸ©é˜µå¯ä»¥è¡¨ç¤ºä¸ºåˆç­‰çŸ©é˜µçš„ä¹˜ç§¯ï¼Œè€Œåˆç­‰å˜æ¢ä¸æ”¹å˜çŸ©é˜µçš„ç§©ã€‚ 
å¯¹äºä¸€ä¸ªçŸ©é˜µæ–½è¡Œä¸€æ¬¡åˆç­‰**åˆ—å˜æ¢**ç›¸å½“äºåœ¨è¿™ä¸ªçŸ©é˜µ**å³ä¹˜**ä¸€ä¸ªç›¸åº”çš„åˆç­‰çŸ©é˜µ 
å¯¹äºä¸€ä¸ªçŸ©é˜µæ–½è¡Œä¸€æ¬¡åˆç­‰**è¡Œå˜æ¢**ç›¸å½“äºåœ¨è¿™ä¸ªçŸ©é˜µ**å·¦ä¹˜**ä¸€ä¸ªç›¸åº”çš„åˆç­‰çŸ©é˜µ 
$E = t^{^\wedge}R$
Rank(R)=3,Rå¯é€†çŸ©é˜µ
*Rank(t^)=2* 
![](./orbslam_images/GetImage28.jpeg)
Rä¸ä¼šæ”¹å˜çŸ©é˜µçš„ç§©ï¼Œå› æ­¤EçŸ©é˜µçš„ç§©ä¸º2. 
Rank(E)=Rank(t^)=2
ï¼ˆ2ï¼‰å› ä¸ºæœ¬è´¨çŸ©é˜µ E çš„å¥‡å¼‚å€¼å¿…å®šæ˜¯ $[Ïƒ, Ïƒ, 0]^T$ çš„å½¢å¼ï¼ŒçŸ©é˜µçš„ç§©ç­‰äºéé›¶å¥‡å¼‚å€¼çš„ä¸ªæ•°
è¯æ˜ä¸€ï¼šä¸‰ç»´åå¯¹ç§°çŸ©é˜µçš„åˆ†è§£
![](./orbslam_images/GetImage29.jpeg)
è¯æ˜äºŒï¼šSVDåˆ†è§£ä¸çŸ©é˜µçš„è¿¹
![](./orbslam_images/GetImage30.jpeg)

#### äºŒï¼šä¸ºä»€ä¹ˆåŸºç¡€çŸ©é˜µ(F)çš„ç§©ä¸º2
$\boldsymbol{F} = \boldsymbol{K}^{-T}\mathbf{t}^{\wedge}\boldsymbol{R}\boldsymbol{K}^{-1}$
ä¸¤ä¸ªç›¸æœºå†…å‚çŸ©é˜µå’Œæ—‹è½¬çŸ©é˜µRéƒ½æ˜¯æ»¡ç§©çŸ©é˜µï¼ˆå¯é€†çŸ©é˜µï¼‰ï¼Œ$\mathbf{t}^{\wedge}$æ˜¯ä¸€ä¸ªç§©ä¸º2çš„çŸ©é˜µï¼ŒåŒæ ·ï¼ŒçŸ©é˜µä¹˜ä»¥å¯é€†çŸ©é˜µç§©ä¸å˜ï¼Œå› ä¸ºå¯é€†çŸ©é˜µå¯ä»¥è¡¨ç¤ºä¸ºåˆç­‰çŸ©é˜µçš„ä¹˜ç§¯ï¼Œè€Œåˆç­‰å˜æ¢ä¸æ”¹å˜çŸ©é˜µçš„ç§©ï¼ˆå·¦ä¹˜-è¡Œå˜æ¢ï¼Œå³ä¹˜-åˆ—å˜æ¢ï¼‰ã€‚ 

#### ä¸‰ï¼šä¸ºä»€ä¹ˆå°ºåº¦ç­‰ä»·æ€§è¦å‡å°‘ä¸€ä¸ªè‡ªç”±åº¦ï¼Ÿ
ä»¥æœ¬è´¨çŸ©é˜µä¸ºä¾‹ï¼Œè¡¨è¾¾ä¸¤å¸§çš„ç›¸æœºå½’ä¸€åŒ–åæ ‡ä¹‹é—´çš„å¯¹åº”å…³ç³»
![](./orbslam_images/GetImage32.png)
å°†çŸ©é˜µå†™æˆå‘é‡ï¼Œè½¬åŒ–ä¸ºä¸‹å¼ï¼š 
![](./orbslam_images/GetImage33.png)
ç”±äºç­‰å¼å³ä¾§æ˜¯0ï¼Œæ‰€ä»¥ä¸Šé¢ä¸¤å¼å­ä¹˜ä»¥ä»»æ„å¸¸æ•°ä»¥åè¿˜æ˜¯è¡¨ç¤ºåŒæ ·ä¸¤ç‚¹ä¹‹é—´çš„å˜æ¢ï¼Œæ‰€ä»¥Eæ˜¯å°ºåº¦ç­‰ä»·çš„ã€‚ 
ç”±äºå°ºåº¦ç­‰ä»·æ€§ï¼Œæ‰€ä»¥å¯¹äº9ä¸ªå‚æ•°çš„å‘é‡eï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡8ä¸ªæ–¹ç¨‹è®¡ç®—å‡ºå…¶ä¸­8ä¸ªæœªçŸ¥æ•°å³å¯ï¼Œ 8ä¸ªæ•°éƒ½ç”¨ç¬¬9ä¸ªæ•°è¡¨ç¤ºï¼Œç”±äºå°ºåº¦ç­‰ä»·ï¼Œæ‰€ä»¥ç¬¬9ä¸ªæ•°å–ä»€ä¹ˆå€¼éƒ½æ˜¯å¯¹çš„ã€‚ 
å•ç›®ç›¸æœºçš„åˆå§‹åŒ–å¾€å¾€ç”±å¯¹æå‡ ä½•çº¦æŸå®Œæˆã€‚å¯¹æå‡ ä½•çº¦æŸåº”ç”¨çš„åœºæ™¯æ˜¯å·²çŸ¥ä¸¤å¹…å›¾åƒä¹‹é—´è‹¥å¹²åŒ¹é…ç‚¹ï¼Œæ±‚è§£ä¸¤å¹…å›¾åƒä¹‹é—´çš„ç›¸æœºè¿åŠ¨ï¼Œæ˜¯ä¸€ä¸ª2D-2Dçš„é—®é¢˜ã€‚è¯¦ç»†çš„æ¨å¯¼è¿‡ç¨‹å¯ä»¥å‚è€ƒã€Šè§†è§‰SLAM14è®²ã€‹ä¸­çš„è¿‡ç¨‹ï¼Œå…¶æ ¸å¿ƒæ±‚è§£æ˜¯ä¸€ä¸ªæœ¬è´¨çŸ©é˜µEï¼ˆæˆ–è€…å¸¦æœ‰å†…å‚çŸ©é˜µçš„åŸºç¡€çŸ©é˜µï¼‰ï¼Œæœ¬è´¨çŸ©é˜µEçš„ç‰¹ç‚¹æ˜¯å…·æœ‰å°ºåº¦ç­‰ä»·æ€§ã€‚ä½å§¿Rå’Œtæ˜¯ç”±Eé€šè¿‡å¥‡å¼‚å€¼åˆ†è§£å¾—åˆ°çš„ï¼Œå…¶ä¸­Ræ˜¯æ­£äº¤çŸ©é˜µï¼Œå…¶é€†ç­‰äºè‡ªèº«çš„è½¬ç½®ï¼Œç›¸å½“äºè‡ªèº«çš„çº¦æŸå¯ä»¥å…‹æœæ‰å°ºåº¦ç­‰ä»·æ€§ï¼›ä½†æ˜¯tæ²¡æœ‰åŠæ³•å…‹æœå°ºåº¦ç­‰ä»·æ€§ï¼Œå³è¿™ä¸ªtä¹˜ä¸Šä»»æ„ä¸€ä¸ªéé›¶çš„æ­£æ•°ï¼Œéƒ½èƒ½æ»¡è¶³å¯¹æå‡ ä½•çº¦æŸã€‚   
![alt text](./orbslam_images/image-6.png)
å¯¹æå‡ ä½•çº¦æŸçš„å‡ ä½•æ„ä¹‰æ˜¯$O_L,O_R,X$ä¸‰ç‚¹å…±é¢ï¼Œ**çº¯æ—‹è½¬æƒ…å†µä¸‹$O_L,O_R$å…±ç‚¹ï¼Œtä¸º0ï¼Œæœ¬è´¨çŸ©é˜µä¹Ÿä¸º0,æ— æ³•åˆ†è§£å‡ºRï¼Œå•ç›®åˆå§‹åŒ–ä¸èƒ½åªæœ‰çº¯æ—‹è½¬ï¼Œå¿…é¡»æœ‰ä¸€å®šç¨‹åº¦çš„å¹³ç§»ã€‚**ã€‚é€šå¸¸çš„åˆå§‹åŒ–åšæ³•æ˜¯ï¼Œå°†tå½’ä¸€åŒ–ï¼Œè®©å…¶é•¿åº¦ç­‰äº$\lVert t \rVert = 1$ï¼Œå¹¶ä½œä¸ºå•ä½è®¡ç®—ç›¸æœºçš„è¿åŠ¨å’Œå›¾åƒç‰¹å¾ç‚¹å¯¹åº”çš„3Dç‚¹ä½ç½®ã€‚åˆå§‹åŒ–ä¹‹åï¼Œä¾¿å¯ä»¥åˆ©ç”¨3D-2Dçš„PnPæ–¹æ³•ï¼Œæ±‚è§£åç»­ç›¸é‚»å¸§çš„è¿åŠ¨ä½å§¿ã€‚è‡³äºè¿™ä¸ªé•¿åº¦1å¯¹åº”åˆ°çœŸå®ä¸–ç•Œä¸­çš„é•¿åº¦å¯èƒ½æ˜¯5cm,ä¹Ÿå¯èƒ½æ˜¯40mï¼Œè¿™å°±éœ€è¦é¢å¤–çš„æ·±åº¦ä¿¡æ¯ä»‹å…¥è¿›è¡Œç¡®å®šï¼Œè¿™ä¸ªä»¥tçš„é•¿åº¦ä½œä¸ºå•ä½çš„å°ºåº¦ä¸–ç•Œåªå’ŒçœŸå®ä¸–ç•Œä¹‹é—´ç›¸å·®ä¸€ä¸ªå°ºåº¦å› å­ï¼Œä»£ç è§[TwoViewReconstruction.cc](../ORB_SLAM3/src/TwoViewReconstruction.cc)çš„**DecomposeEå‡½æ•°**ã€‚
```C++ 
// å¯¹ t æœ‰å½’ä¸€åŒ–ï¼Œä½†æ˜¯è¿™ä¸ªåœ°æ–¹å¹¶æ²¡æœ‰å†³å®šå•ç›®æ•´ä¸ªSLAMè¿‡ç¨‹çš„å°ºåº¦
// å› ä¸ºCreateInitialMapMonocularå‡½æ•°å¯¹3Dç‚¹æ·±åº¦ä¼šç¼©æ”¾ï¼Œç„¶ååè¿‡æ¥å¯¹ t æœ‰æ”¹å˜
t = t / t.norm();
```
å¯¹té•¿åº¦çš„å½’ä¸€åŒ–ç›´æ¥å¯¼è‡´äº†å•ç›®è§†è§‰çš„å°ºåº¦ä¸ç¡®å®šæ€§ã€‚å¦‚æœå¯¹è½¨è¿¹å’Œåœ°å›¾åŒæ—¶ç¼©æ”¾ä»»æ„å€æ•°ï¼Œæˆ‘ä»¬å¾—åˆ°çš„å›¾åƒä»ç„¶æ˜¯ä¸€æ ·çš„ã€‚è€Œå¯¹ä¸¤å¼ å›¾åƒé—´çš„å¹³ç§»tè¿›è¡Œå½’ä¸€åŒ–ç›¸å½“äºå›ºå®šå°ºåº¦ã€‚ä»¥tçš„é•¿åº¦ä½œä¸ºä¸ºå•ä½é•¿åº¦ï¼Œè®¡ç®—ç›¸æœºè½¨è¿¹å’Œç‰¹å¾ç‚¹çš„ä¸‰ç»´ä½ç½®ã€‚è¿™è¢«ç§°ä¸ºå•ç›® slam çš„åˆå§‹åŒ–ã€‚åˆå§‹åŒ–åï¼Œå°±å¯ä»¥åˆ©ç”¨ 3D - 2D æ¥è®¡ç®—ç›¸æœºè¿åŠ¨äº†ã€‚è¿›è¡Œåˆå§‹åŒ–çš„ä¸¤å¼ å›¾åƒå¿…é¡»æœ‰ä¸€å®šç¨‹åº¦çš„å¹³ç§»ï¼Œè€Œåéƒ½å°†ä»¥æ­¤æ­¥é•¿çš„å¹³ç§»ä¸ºå•ä½ã€‚
#### å››ï¼šä¸ºä»€ä¹ˆåŸºç¡€çŸ©é˜µè‡ªç”±åº¦æ˜¯7ï¼Ÿ
$\boldsymbol{F} = \boldsymbol{K}^{-T}\mathbf{t}^{\wedge}\boldsymbol{R}\boldsymbol{K}^{-1}$
å·¦å³ç›¸æœºå†…å‚çš„å¾…å®šå‚æ•°å„ä¸º4ï¼Œå¹³ç§»$\mathbf{t}^{\wedge}$çš„å¾…å®šå‚æ•°æ˜¯3ï¼Œæ—‹è½¬çŸ©é˜µRçš„è‡ªç”±åº¦æ˜¯3ï¼ŒåŠ åœ¨ä¸€èµ·æ˜¯14ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯æ­£å¸¸æ¥è¯´æŠŠ14ä¸ªå‚æ•°éƒ½ç¡®å®šäº†æ‰èƒ½ç¡®å®šFï¼Œä½†æ˜¯å®é™…ä¸ŠFæ˜¯ä¸€ä¸ª3*3çš„çŸ©é˜µï¼ŒåªåŒ…å«9ä¸ªå‚æ•°ï¼Œæ‰€ä»¥è®¡ç®—Fçš„è‡ªç”±åº¦æœ€å¤§æ˜¯9ï¼Œä¹Ÿå°±æ˜¯9ä¸ªå‚æ•°å°±å¯ä»¥ç¡®å®šFã€‚ 
åŒæ—¶Fæ»¡è¶³ä¸‹é¢ä¸¤ä¸ªçº¦æŸï¼Œæ‰€ä»¥Fçš„è‡ªç”±åº¦æ˜¯9-2=7. 
ï¼ˆ1ï¼‰ç§©çº¦æŸï¼šåŸºç¡€çŸ©é˜µçš„ç§©å¿…é¡»æ˜¯ 2ï¼Œè¿™ä¸ªçº¦æŸå‡å°‘äº†ä¸€ä¸ªè‡ªç”±åº¦ã€‚
ï¼ˆ2ï¼‰å°ºåº¦ä¸å˜æ€§ï¼šåŸºç¡€çŸ©é˜µæ˜¯ä¸å…¶å°ºåº¦ä¸å˜çš„ï¼Œå³å¦‚æœå°†çŸ©é˜µä¹˜ä»¥ä¸€ä¸ªå¸¸æ•°ğœ†ï¼ŒçŸ©é˜µæœ¬èº«çš„å‡ ä½•æ„ä¹‰ä¸ä¼šæ”¹å˜ã€‚è¿™ä¸ªçº¦æŸåˆå‡å°‘äº†ä¸€ä¸ªè‡ªç”±åº¦ï¼ˆå› ä¸ºçŸ©é˜µå¯ä»¥ä¹˜ä»¥ä¸€ä¸ªéé›¶å¸¸æ•°è€Œä¸æ”¹å˜å…¶å‡ ä½•æ„ä¹‰ï¼‰ã€‚

#### äº”ï¼šä¸ºä»€ä¹ˆæœ¬è´¨çŸ©é˜µè‡ªç”±åº¦æ˜¯5ï¼Ÿ
ï¼ˆ1ï¼‰ç§©çº¦æŸï¼šå‡å°‘äº† 1 ä¸ªè‡ªç”±åº¦ï¼ˆä» 9 åˆ° 8ï¼‰ã€‚
ï¼ˆ2ï¼‰å°ºåº¦ä¸å˜æ€§ï¼šå‡å°‘äº† 1 ä¸ªè‡ªç”±åº¦ï¼ˆä» 8 åˆ° 7ï¼‰ã€‚
ï¼ˆ3ï¼‰ç›¸æœºå†…å‚å·²çŸ¥ï¼šæä¾›äº†é¢å¤–çš„çº¦æŸï¼Œè¿›ä¸€æ­¥å‡å°‘äº†è‡ªç”±åº¦ï¼ˆä» 7 åˆ° 5ï¼‰ã€‚ 

#### å…­ï¼šä¸ºä»€ä¹ˆå•åº”çŸ©é˜µè‡ªç”±åº¦æ˜¯8ï¼Ÿ
å•åº”çŸ©é˜µä¹Ÿå…·æœ‰å°ºåº¦ç­‰ä»·æ€§ï¼š9-1=8 
![](./orbslam_images/GetImage35.jpeg)

## åŸºç¡€çŸ©é˜µ   

### å¯¹æå‡ ä½•  
![alt text](image-7.png)  
ä¸Šå›¾å±•ç¤ºäº†ä¸€å¯¹åŒ¹é…å¥½çš„ç‰¹å¾ç‚¹ã€‚æˆ‘ä»¬å¸Œæœ›æ±‚å–è¿™ä¸¤å¸§ä¹‹é—´çš„è¿åŠ¨ã€‚è®¾ä¸¤ä¸ªç›¸æœºå…‰å¿ƒåˆ†åˆ«ä¸º$O_1$å’Œ$O_2$ ï¼Œç¬¬ä¸€å¸§åˆ°ç¬¬äºŒå¸§åˆ°è¿åŠ¨ä¸º$Rï¼Œt$ã€‚ç‚¹$p_1$å’Œç‚¹$p_2$ æ˜¯åŒä¸€ä¸ªç©ºé—´ç‚¹Påœ¨ä¸¤ä¸ªæˆåƒå¹³é¢ä¸Šçš„æŠ•å½±ã€‚è¿çº¿$O_1 \ p_1$å’Œ$O_2 \ p_2$åœ¨ä¸‰ç»´ç©ºé—´ä¸­ç›¸äº¤äºç‚¹P ã€‚è¿™æ—¶ï¼Œ$O_1, O_2$å’ŒPä¸‰ç‚¹ç¡®å®šä¸€ä¸ªå¹³é¢ï¼Œç§°ä¸ºæå¹³é¢ (epipolar plane)ã€‚è¿çº¿$O_1, O_2$ä¸åƒå¹³é¢$I_1, I_2$çš„äº¤ç‚¹åˆ†åˆ«ä¸º$e_1, e_2$ã€‚ç‚¹$e_1, e_2$ç§°ä¸ºæç‚¹ (epipoles)ï¼Œæ˜¯ç›¸æœºå…‰å¿ƒåœ¨å¦ä¸€å¹…å½±åƒä¸Šçš„æŠ•å½±ã€‚æ³¨æ„åˆ°è¿™é‡Œ$e_1, e_2$éƒ½ä½äºåƒå¹³é¢å†…ã€‚æœ‰æ—¶å€™å®ƒä»¬æœ‰å¯èƒ½ä¼šè½åœ¨æˆåƒå¹³é¢ä¹‹å¤–ã€‚
$O_1, O_2$ç§°ä¸ºåŸºçº¿ (baseline)ã€‚è€Œæå¹³é¢ä¸ä¸¤ä¸ªåƒå¹³é¢ä¹‹é—´çš„äº¤çº¿$l_1, l_2$ä¸ºæçº¿ (epipolar line)ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯å°„çº¿$O_2 \ p_2$å’Œ$O_1 \ p_1$ åœ¨å¯¹æ–¹å½±åƒä¸Šçš„æŠ•å½±ã€‚
ä»å‡ ä½•ä¸Šæ¥çœ‹ï¼Œå°„çº¿$O_1 \ p_1$æ˜¯åƒç´ ç‚¹$p_1$æ‰€å¯¹åº”çš„ç‰©æ–¹ç‚¹å¯èƒ½å‡ºç°çš„ä½ç½®ï¼šè¯¥å°„çº¿ä¸Šçš„æ‰€æœ‰ç‚¹éƒ½æœ‰å¯èƒ½æŠ•å½±åˆ°ç‚¹$p_1$ä¸Šã€‚å°„çº¿$O_2 \ p_2$æ˜¯åƒç´ ç‚¹$p_2$æ‰€å¯¹åº”çš„ç‰©æ–¹ç‚¹å¯èƒ½å‡ºç°çš„ä½ç½®ã€‚å¦‚æœåŒ¹é…æ­£ç¡®çš„è¯ï¼Œåƒç´ ç‚¹$p_2$å¯¹åº”äºåŒä¸€ä¸ªç‰©æ–¹ç‚¹ã€‚è¿™ä¸¤æ¡å°„çº¿çš„äº¤ç‚¹å°±æ˜¯å°±æ˜¯ç‚¹Pçš„ç©ºé—´ä½ç½®ã€‚å¦‚æœæ²¡æœ‰ç‰¹å¾åŒ¹é…ï¼Œæˆ‘ä»¬å°±å¿…é¡»åœ¨æçº¿$l_2$ä¸Šæœç´¢$p_1$çš„åŒ¹é…ç‚¹ã€‚
ç°åœ¨æˆ‘ä»¬ä»ä»£æ•°çš„è§’åº¦ä¸Šçœ‹ï¼Œåœ¨ç¬¬ä¸€å¸§çš„ç›¸æœºåæ ‡ç³»ä¸‹ï¼Œç‚¹Pçš„ç©ºé—´ä½ç½®ä¸ºï¼š$\mathbf{P}=[X, Y, Z]^T$     
æ ¹æ®é’ˆå­”ç›¸æœºæ¨¡å‹ï¼Œä¸è€ƒè™‘ç•¸å˜ï¼Œä¸¤ä¸ªåƒç´ ç‚¹$p_1$,$p_2$ç‚¹åƒç´ ï¼ˆ$u,v$ï¼‰åæ ‡åˆ†åˆ«ä¸ºï¼š$s_1\mathbf{p}_1=\mathbf{K}\mathbf{P},\ s_2\mathbf{p}_2=\mathbf{K}(\mathbf{R}\mathbf{P}+\mathbf{t})$   
$s_1p_1$å’Œ$p_1$æˆæŠ•å½±å…³ç³»ï¼Œä»–ä»¬åœ¨é½æ¬¡åæ ‡ç³»ä¸‹æ˜¯ç›¸ç­‰çš„ï¼Œæˆ‘ä»¬ç§°è¿™ç§å…³ç³»ä¸ºå°ºåº¦æ„ä¹‰ä¸‹ç›¸ç­‰ï¼Œè®°ä½œï¼š$sp\simeq p$      
åœ¨ä½¿ç”¨é½æ¬¡åæ ‡çš„æ—¶å€™ï¼Œä¸€ä¸ªå‘é‡å°†ç­‰äºå®ƒè‡ªèº«ä¹˜ä»¥ä¸€ä¸ªéé›¶çš„å¸¸æ•°ï¼Œè¿™é€šå¸¸ç”¨äºè¡¨è¾¾ä¸€ä¸ªæŠ•å½±å…³ç³»ï¼Œ$s_1p_1=p_1$ï¼Œè¿™é‡Œå¯ä»¥å‚è€ƒä¸€ä¸‹14è®²ä¸­P100é¡µå…³äºå½’ä¸€åŒ–å¹³é¢å’Œå½’ä¸€åŒ–åæ ‡çš„å®šä¹‰ï¼š
å½’ä¸€åŒ–åæ ‡å¯ä»¥çœ‹ä½œç›¸æœºå‰æ–¹$z=1$å¤„å¹³é¢ä¸Šçš„ä¸€ä¸ªç‚¹ï¼Œè¿™ä¸ª$z=1$çš„å¹³é¢ä¸Šçš„ç‚¹ä¹Ÿå«åšå½’ä¸€åŒ–å¹³é¢ã€‚å½’ä¸€åŒ–åæ ‡å†å·¦ä¹˜å†…å‚å³å¯å¾—åˆ°åƒç´ åæ ‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†åƒç´ åæ ‡$(u,v)$çœ‹ä½œæ˜¯å½’ä¸€åŒ–å¹³é¢ä¸Šçš„ç‚¹è¿›è¡Œé‡åŒ–æµ‹é‡çš„ç»“æœ
$$
\mathbf{RP_w +t}=\underbrace{[X,Y,Z]^T }_{ç›¸æœºåæ ‡ç³»} \rightarrow \underbrace{[\frac{X}{Z},\frac Y Z ,1]}_{å½’ä¸€åŒ–åæ ‡ç³»}
$$
æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹é’ˆå­”ç›¸æœºçš„æŠ•å½±æ¨¡å‹:
$$
\begin{pmatrix}
 u\\
 v\\
1
\end{pmatrix} = \frac{1}{Z} \begin{pmatrix}
  f_x& 0 &c_x \\
  0& f_y  &c_y \\
 0 &0  &1
\end{pmatrix}\begin{pmatrix}
 X\\
Y \\
Z
\end{pmatrix} \overset{\mathrm{def}}{=} \frac{1}{Z}KP
$$
é’ˆå­”ç›¸æœºçš„æˆåƒæ¨¡å‹ä¸­æœ¬èº«å¯¹äºZå°±æ˜¯æœªçŸ¥çš„æ— çº¦æŸçš„ã€‚    
é‚£ä¹ˆä¸Šè¿°çš„ä¸¤ä¸ªæŠ•å½±å…³ç³»å¯ä»¥å†™æˆ:$p_1 \simeq KP,p_2\simeq K(RP+t)$   
è¿™é‡ŒKä¸ºç›¸æœºå†…å‚çŸ©é˜µã€‚å¦‚æœä½¿ç”¨é½æ¬¡åæ ‡ï¼Œåˆ™å‰é¢çš„ç³»æ•°$s_1, s_2$å¯ä»¥çœç•¥ã€‚è®¾ï¼š
$$
\mathbf{x}_1=\mathbf{K}^{-1}\mathbf{p}_1,\ \mathbf{x}_2=\mathbf{K}^{-1}\mathbf{p}_2
$$    
è¿™é‡Œï¼Œ$x_1$å’Œ$x_2$åˆ†åˆ«ä¸ºä¸¤ä¸ªåƒç´ ç‚¹åœ¨å„è‡ªç›¸æœºåæ ‡ç³»ä¸‹çš„å½’ä¸€åŒ–å¹³é¢åæ ‡ã€‚å°†ä¹‹ä»£å…¥ä¸Šå¼ï¼ˆå°† $p_1,p_2$åˆ†åˆ«å¸¦å…¥ä¸Šé¢çš„å¼å­ï¼‰å¯å¾—ï¼š
$$
\mathbf{x}_2 = \mathbf{R}\mathbf{x}_1+\mathbf{t}
$$   
ä¸Šé¢å…¬å¼å»é™¤å°ºåº¦å› å­ä¹‹åä»ç„¶æˆç«‹ï¼Ÿå…¶å®å¸¦ä¸Šå°ºåº¦å› å­æ¨å€’äº†ä¸€éï¼Œå‘ç°ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å°ºåº¦æ— æ³•å½±å“å¯¹æçº¦æŸï¼Œå½“ç„¶æ±‚è§£å‡ºæ¥çš„ç»“æœä¸­çš„$t$,å½“ç„¶ä¸æ˜¯çœŸå®çš„å°ºåº¦äº†ï¼Œè¿™é‡Œæ”¾å‡ºæ¨å€’è¿‡ç¨‹ï¼š
![alt text](image-8.png)   
å°†ä¸Šå¼ä¸¤è¾¹åŒæ—¶å·¦ä¹˜$\mathbf{t}^{\wedge}$ï¼Œè¿™ç›¸å½“äºä¸¤ä¾§åŒæ—¶å’Œ$t$åšå¤–ç§¯ï¼š
$$
\mathbf{t}^{\wedge}\mathbf{x}_2=\mathbf{t}^{\wedge}\mathbf{R}\mathbf{x}_1
$$  
å†å°†ä¸¤ä¾§åŒæ—¶å·¦ä¹˜$\mathbf{x}^T_2$:
$$
\mathbf{x}^T_2\mathbf{t}^{\wedge}\mathbf{x}_2=\mathbf{x}^T_2\mathbf{t}^{\wedge}\mathbf{R}\mathbf{x}_1
$$    
æ³¨æ„åˆ°$\mathbf{t}^{\wedge}\mathbf{x}_2$æ˜¯ä¸€ä¸ªå‚ç›´äºäºŒè€…çš„å‘é‡ï¼Œå› æ­¤å®ƒå’Œ$x_2$çš„å†…ç§¯ä¸º0ã€‚ç”±æ­¤å¯å¾—ï¼š
$$
\mathbf{x}^T_2\mathbf{t}^{\wedge}\mathbf{R}\mathbf{x}_1=0
$$
å¦‚æœæˆ‘ä»¬ä»£å…¥$p_1, p_2$åˆ™å¯å¾—ï¼š
$$
\mathbf{p}^T_2\mathbf{K}^{-T}\mathbf{t}^{\wedge}\mathbf{R}\mathbf{K}^{-1}\mathbf{p}_1=0
$$  
è¿™ä¸¤ä¸ªå¼å­ç§°ä¸ºå¯¹æçº¦æŸã€‚å®ƒçš„å‡ ä½•æ„ä¹‰ä¸º$O_1, O_2$ å’ŒPä¸‰ç‚¹å…±é¢ã€‚è¿™ä¸¤ä¸ªå¼å­çš„ä¸­é—´éƒ¨åˆ†åˆ†åˆ«ç§°ä¸ºæœ¬è´¨çŸ©é˜µ (essential matrix) Eå’ŒåŸºç¡€çŸ©é˜µ (fundamental matrix) Fã€‚
$$
\mathbf{E} = \mathbf{t}^{\wedge}\mathbf{R}   \\ 
\mathbf{F} =\mathbf{K}^{-T}\mathbf{t}^{\wedge}\mathbf{R}\mathbf{K}^{-1} \\
\mathbf{x}_2^T\mathbf{E}\mathbf{x}_1=\mathbf{p}_2^T\mathbf{F}\mathbf{p}_1=0
$$
### è®¡ç®—åŸºç¡€çŸ©é˜µ
è®¡ç®—åŸºç¡€çŸ©é˜µçš„å‡½æ•°å®šä¹‰åœ¨[TwoViewReconstruction::FindFundamental()](../ORB_SLAM3/src/TwoViewReconstruction.cc)ï¼Œè®¡ç®—åŸºç¡€çŸ©é˜µ *f*, 8ç»„å¯¹åº”åæ ‡ç‚¹æ„æˆç³»æ•°çŸ©é˜µAï¼Œç»´åº¦ä¸º8*9ã€‚ 
å‡è®¾$\boldsymbol{x} = \begin{bmatrix} u & v & 1 \end{bmatrix}^T$ä¸ºå‚è€ƒå¸§ä¸­çš„åƒç´ é½æ¬¡åæ ‡ï¼Œ $\boldsymbol{x'} = \begin{bmatrix} u' & v' & 1 \end{bmatrix}^T$ä¸ºå½“å‰å¸§ä¸­ä¸ä¹‹åŒ¹é…çš„åæ ‡ã€‚é‚£ä¹ˆå¼(1)å¯ä»¥å±•å¼€å¦‚ä¸‹:
$$
\begin{array}{c}
            \begin{bmatrix} u' & v' & 1 \end{bmatrix}
            \begin{bmatrix}
                f_{11} & f_{12} & f_{13} \\
                f_{21} & f_{22} & f_{23} \\
                f_{31} & f_{32} & f_{33}
            \end{bmatrix}
            \begin{bmatrix} u \\ v \\ 1 \end{bmatrix} = 0
        \end{array} \\
$$
$       u'uf_{11} + u'v f_{12} + u' f_{13} + v'u f_{21} + v'vf_{22} + v'f_{23} + uf_{31} + vf_{32} + f_{33} = 0$    
è®°$\boldsymbol{f} = \begin{bmatrix} f_{11} & f_{12} & f_{13} & f_{21} & f_{22} & f_{23} & f_{31} & f_{32} & f_{33} \end{bmatrix}^T$,å‡è®¾æˆ‘ä»¬æœ‰ m å¯¹åŒ¹é…ç‚¹ï¼Œæ ¹æ®ä¸Šå¼æˆ‘ä»¬å¯ä»¥å†™å‡º m ä¸ªçº¦æŸï¼Œå¯ä»¥å†™æˆ Af=0çš„çŸ©é˜µå½¢å¼ï¼Œå¦‚ä¸‹:   

$$
\begin{equation}\
            \boldsymbol{Af} = \begin{bmatrix}
                u_1'u_1 & u_1'v_1 & u_1'   & v_1'u_1 & v_1'v_1 &   v_1' &    u_1 &    v_1 & 1 \\
                 \vdots &  \vdots & \vdots &  \vdots &  \vdots & \vdots & \vdots & \vdots &   \\
                u_m'u_m & u_m'v_m & u_m'   & v_m'u_m & v_m'v_m & v_m'   &    u_m &    v_m & 1 \\
            \end{bmatrix} \boldsymbol{f} = \boldsymbol{0}
        \end{equation}
$$

é€šå¸¸æˆ‘ä»¬ä¼šæ‰¾åˆ°å¾ˆå¤šå¯¹åŒ¹é…ç‚¹ï¼Œæ„å»ºçŸ©é˜µ Aï¼Œå¾—åˆ°ä¸€ä¸ªè¶…å®šæ–¹ç¨‹ç»„ã€‚ç”±äºæµ‹é‡å™ªå£°çš„å­˜åœ¨ï¼ŒåŸºæœ¬ä¸Šæ‰¾ä¸åˆ°ä¸€ä¸ªè§£èƒ½å¤Ÿä½¿å¾—æ–¹ç¨‹æˆç«‹ã€‚ ä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡æœ€å°äºŒä¹˜æ³•æ‰¾åˆ°ä¸€ä¸ªfï¼Œä½¿Afå°½å¯èƒ½çš„æ¥è¿‘ 0ã€‚æ ¹æ® MVG ä¸€ä¹¦çš„è¯´æ³•ï¼Œ å¯¹çŸ©é˜µ A è¿›è¡ŒSVDåˆ†è§£ $A = U{\Sigma}V^{T}$ï¼Œå–Vä¸­çš„æœ€åä¸€åˆ—ï¼Œå°±æ˜¯ä¸€ä¸ªèƒ½å¤Ÿæœ€å°åŒ–$\|\boldsymbol{Af} \| / \| \boldsymbol{f} \|$çš„è§£ã€‚ æˆ‘ä»¬è‡³å°‘éœ€è¦8ä¸ªç‚¹æ‰èƒ½æ±‚å¾—åŸºç¡€çŸ©é˜µï¼Œè¿™ä¹Ÿå°±æ˜¯æ‰€è°“çš„**å…«ç‚¹æ³•**ã€‚
#### å½’ä¸€åŒ–8ç‚¹æ³•
8ç‚¹æ³•æˆåŠŸçš„å…³é”®æ˜¯åœ¨æ„é€ è§£çš„æ–¹ç¨‹ä¹‹å‰åº”å¯¹è¾“å…¥çš„æ•°æ®è®¤çœŸè¿›è¡Œé€‚å½“çš„å½’ ä¸€åŒ–ï¼Œä¸ºäº†é˜²æ­¢ä¸åŒåˆ†è¾¨ç‡ã€å°ºåº¦å’Œåæ ‡**åŸç‚¹**ä¸‹çš„å½±å“ï¼Œå›¾åƒç‚¹çš„ä¸€ä¸ªç®€å•å˜æ¢(å¹³ç§»æˆ–å˜å°ºåº¦)å°†ä½¿è¿™ä¸ªé—®é¢˜çš„æ¡ä»¶æå¤§åœ°æ”¹å–„ï¼Œä»è€Œæé«˜ç»“æœçš„ç¨³å®šæ€§ï¼Œå‡½æ•°å®šä¹‰åœ¨[TwoViewReconstruction::Normalize()](../ORB_SLAM3/src/TwoViewReconstruction.cc)ã€‚ 
##### ç®—æ³•æ­¥éª¤
![](./orbslam_images/GetImage39.png)

##### å¯¹ç‰¹å¾ç‚¹å½’ä¸€åŒ–å˜æ¢ 
ç³»æ•°çŸ©é˜µAæ˜¯åˆ©ç”¨8ç‚¹æ³•æ±‚åŸºç¡€çŸ©é˜µçš„å…³é”®ï¼Œæ‰€ä»¥Harteyå°±è®¤ä¸ºï¼Œåˆ©ç”¨8ç‚¹æ³•æ±‚åŸºç¡€çŸ©é˜µä¸ç¨³å®šçš„ä¸€ä¸ªä¸»è¦åŸå› å°±æ˜¯åŸå§‹çš„å›¾åƒåƒç‚¹åæ ‡ç»„æˆçš„ç³»æ•°çŸ©é˜µAä¸å¥½é€ æˆçš„ï¼Œè€Œé€ æˆAä¸å¥½çš„åŸå› æ˜¯åƒç‚¹çš„é½æ¬¡åæ ‡å„ä¸ªåˆ†é‡çš„æ•°é‡çº§ç›¸å·®å¤ªå¤§ã€‚åŸºäºè¿™ä¸ªåŸå› ï¼ŒHarteyæå‡ºä¸€ç§æ”¹è¿›çš„8ç‚¹æ³•ï¼Œåœ¨åº”ç”¨8ç‚¹æ³•æ±‚åŸºç¡€çŸ©é˜µä¹‹å‰ï¼Œå…ˆå¯¹åƒç‚¹åæ ‡è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Œå³å¯¹åŸå§‹çš„å›¾åƒåæ ‡åšåŒå‘æ€§å˜æ¢ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘å™ªå£°çš„å¹²æ‰°ï¼Œå¤§å¤§çš„æé«˜8ç‚¹æ³•çš„ç²¾åº¦ã€‚
æ­¥éª¤ä¸€ï¼š æ±‚å–æ‰€æœ‰ N ä¸ªç‰¹å¾ç‚¹çš„è´¨å¿ƒåæ ‡ï¼ˆX, Yï¼‰
$$
meanX = \frac{\sum_{N}^{i=0}u_{i}}{N},\quad meanY = \frac{\sum_{N}^{i=0}v_{i}}{N}
$$
æ­¥éª¤äºŒï¼š è®¡ç®—æ‰€æœ‰ç‚¹ç›¸å¯¹äºè´¨å¿ƒçš„å¹³å‡è·ç¦»
$$
meanDevX = \frac{\sum_{N}^{i=0}\left | u_{i}-meanX \right |}{N},\quad meanDevY = \frac{\sum_{N}^{i=0}\left | v_{i}-meanY \right |}{N}
$$
å¹¶å°†å¹³å‡è·ç¦»çš„å€’æ•°ä½œä¸ºç¼©æ”¾å°ºåº¦å› å­
$$
sX = \frac{1}{meanDevX} ,\quad sY = \frac{1}{meanDevY}
$$
æ­¥éª¤ä¸‰ï¼š å¯¹ç‰¹å¾ç‚¹çš„ x å’Œ y åæ ‡è¿›è¡Œç¼©æ”¾ï¼Œä½¿å¾—ä¸€é˜¶ç»å¯¹çŸ©ä¸º 1ï¼Œä»¥æ­¤ä½œä¸ºå½’ä¸€åŒ–çš„ç»“æœåæ ‡
$$
x=x\cdot sX, \quad y = y \cdot  sY
$$
æ­¥éª¤å››ï¼š è·å¾—å½’ä¸€åŒ–çŸ©é˜µ Tï¼ˆç”± x y æ–¹å‘çš„ç¼©æ”¾å› å­å’Œå½’ä¸€åŒ–çš„ç‰¹å¾ç‚¹è´¨å¿ƒç»„æˆï¼‰
$$
T = \begin{bmatrix}
  sX &0  & -meanX\cdot sX\\ 
  0 & sY & -meanY\cdot sY\\ 
  0 & 0 & 1
  \end{bmatrix}
$$
å…³äºä¸€é˜¶ç»å¯¹çŸ©ï¼Œä»€ä¹ˆæ˜¯çŸ©ï¼Ÿ åœ¨ç»Ÿè®¡å­¦ä¸­ï¼ŒçŸ©è¡¨å¾éšæœºé‡çš„åˆ†å¸ƒã€‚â€ƒä¸€é˜¶çŸ©æ˜¯éšæœºå˜é‡çš„æœŸæœ›ï¼ŒäºŒé˜¶çŸ©æ˜¯éšæœºå˜é‡å¹³æ–¹çš„æœŸæœ›ã€‚ä¸€é˜¶ç»å¯¹çŸ©æ˜¯åªå˜é‡ä¸å‡å€¼å·®çš„ç»å¯¹å€¼çš„å¹³å‡ã€‚
##### æ±‚è§£åŸºç¡€çŸ©é˜µFï¼Œæ­¥éª¤åœ¨8ç‚¹æ³•é‡Œ 
ç”±äºåŸºç¡€çŸ©é˜µFåœ¨ä¸€ä¸ªå¸¸é‡å› å­ä¸‹æ˜¯ç­‰ä»·çš„ï¼Œè¿™æ ·å¯ä»¥ç»™åŸºç¡€çŸ©é˜µFçš„å…ƒç´ ç»„æˆçš„å‘é‡fæ–½åŠ ä¸€ä¸ªçº¦æŸæ¡ä»¶ï¼š$\parallel f \parallel = 1$
è¿™æ ·ç”±K>=8ä¸ªåŒ¹é…çš„ç‚¹å¯¹ï¼Œç»„åˆæˆä¸€ä¸ªçŸ©é˜µ$Q_{K\times9}$ï¼Œæ±‚è§£ä¸Šé¢æ–¹ç¨‹å°±å˜æˆäº†æ±‚è§£å¦‚ä¸‹é—®é¢˜çš„æœ€å°äºŒä¹˜è§£
$$
\min_{\parallel f \parallel = 1}\parallel Qf \parallel ^2
$$
å…¶ä¸­ï¼ŒçŸ©é˜µQçš„æ¯ä¸€è¡Œæ¥è‡ªä¸€å¯¹åŒ¹é…ç‚¹ï¼›fæ˜¯åŸºç¡€çŸ©é˜µFå…ƒç´ æ„æˆçš„å¾…æ±‚è§£çš„å‘é‡ï¼Œæ ¹æ®2-èŒƒæ•°çš„å®šä¹‰:
$$
\parallel Qf \parallel^2 = (Qf)^T(Qf)=f^T(Q^TQ)f
$$
å°†ä¸Šå¼çš„ä¸­é—´éƒ¨åˆ†æå–å‡ºæ¥å¾—åˆ°çŸ©é˜µ$M=Q^TQ$,è¿™æ˜¯ä¸€ä¸ª9Ã—9çš„çŸ©é˜µã€‚åŸºäºæ‹‰æ ¼æœ—æ—¥-æ¬§æ‹‰ä¹˜æ•°ä¼˜åŒ–å®šç†ï¼Œåœ¨$\parallel f \parallel = 1$çº¦æŸä¸‹ï¼Œ$Qf=0$çš„æœ€å°äºŒä¹˜è§£ï¼Œä¸ºçŸ©é˜µ$M=Q^TQ$çš„æœ€å°ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡ã€‚æ‰€ä»¥å¯ä»¥å¯¹çŸ©é˜µQè¿›è¡Œå¥‡å¼‚å€¼åˆ†è§£ï¼ˆSVDï¼‰ï¼Œ$Q = U\Sigma V^T$ã€‚æœ€å°äºŒä¹˜è§£å°±æ˜¯$V^T$çš„ç¬¬9ä¸ªåˆ—å‘é‡ï¼Œä¹Ÿå°±æ˜¯å¯ç”±å‘é‡$f = V_9$æ„é€ åŸºç¡€çŸ©é˜µFã€‚
![](./orbslam_images/GetImage37.png)
##### è§£é™¤å½’ä¸€åŒ– 
![](./orbslam_images/GetImage41.jpeg)

### åŸºç¡€çŸ©é˜µçš„åˆ†è§£  
åŸºç¡€çŸ©é˜µçš„åˆ†è§£å‡½æ•°å®šä¹‰åœ¨[TwoViewReconstruction::ReconstructF()](../ORB_SLAM3/src/TwoViewReconstruction.cc)ï¼Œæœ¬è´¨çŸ©é˜µåˆ†è§£å®šä¹‰åœ¨**TwoViewReconstruction::DecomposeEå‡½æ•°**ã€‚

æ ¹æ®åŸºç¡€çŸ©é˜µ$\boldsymbol{F} = \boldsymbol{K}^{-T}\mathbf{t}^{\wedge}\boldsymbol{R}\boldsymbol{K}^{-1}$å’Œæœ¬è´¨çŸ©é˜µ$\boldsymbol{E} = \mathbf{t}^{\wedge}\boldsymbol{R}$çš„å®šä¹‰ï¼Œå…¶ä¸­Kæ˜¯ç›¸æœºçš„å†…å‚çŸ©é˜µï¼Œ æˆ‘ä»¬å¯ä»¥ä»åˆšåˆšæ±‚è§£å‡ºçš„åŸºç¡€çŸ©é˜µä¸­ç®—å‡ºæœ¬å¾çŸ©é˜µ:    
$\boldsymbol{E} = \boldsymbol{K}^T \boldsymbol{FK}$  
æœ¬è´¨çŸ©é˜µEçš„çš„å……åˆ†å¿…è¦æ¡ä»¶æ˜¯çš„å¥‡å¼‚å€¼åˆ†è§£å…·æœ‰å¦‚ä¸‹çš„å½¢å¼,å…¶ä¸­ä»¤a = 1
$$
E=U
\left[\begin{array}{c}
a & &  \\
& a &  \\
& & 0
\end{array}\right]
V^T; \quad a>0 \tag{1.1}
$$
$\mathbf{t}^{\wedge}$,æ˜¯ç”±ç›¸æœºçš„å¹³ç§»å‘é‡tæ„æˆçš„åå¯¹ç§°çŸ©é˜µï¼Œè®°ä½œSå§,å¯¹äºä»»æ„çš„3Ã—3çš„æ–œå¯¹ç§°çŸ©é˜µéƒ½å¯ä»¥åˆ†è§£æˆ$k \boldsymbol{UZU^T}$,å…¶ä¸­Uæ˜¯ä¸€ä¸ªæ­£äº¤çŸ©é˜µï¼Œkä¸ºä¸€ä¸ªéé›¶çš„å¸¸æ•°ã€‚ Zå…·æœ‰å¦‚ä¸‹çš„å½¢å¼ï¼š
$$
\boldsymbol{Z} = \begin{bmatrix}
            0 & 1 & 0 \\
           -1 & 0 & 0 \\
            0 & 0 & 0
        \end{bmatrix} = -\underbrace{\begin{bmatrix}
            1 & 0 & 0 \\
            0 & 1 & 0 \\
            0 & 0 & 0
        \end{bmatrix}}_{\boldsymbol{D}_{1, 1, 0}}\underbrace{\begin{bmatrix}
            0 & -1 & 0 \\
            1 &  0 & 0 \\
            0 &  0 & 1
        \end{bmatrix}}_{\boldsymbol{W}}
$$   
åœ¨å¯¹æçº¦æŸä¸‹ï¼Œæˆ‘ä»¬å¿½ç•¥ç¬¦å·çš„ä½œç”¨ï¼Œæœ‰$\boldsymbol{Z} = \boldsymbol{D}_{1,1,0}\boldsymbol{W}$, å¿½ç•¥å°ºåº¦å› å­kçš„ä½œç”¨ï¼Œæœ‰$\boldsymbol{S} = \boldsymbol{U}\boldsymbol{D}_{1,1,0}\boldsymbol{W}\boldsymbol{U}^T$ã€‚æœ¬å¾çŸ©é˜µå¯ä»¥åˆ†è§£ä¸º$\boldsymbol{E} = \boldsymbol{U}\boldsymbol{D}_{0,0,1}(\boldsymbol{W}\boldsymbol{U}^T\boldsymbol{R})$ã€‚å®¹æ˜“éªŒè¯Wæ˜¯ä¸€ä¸ªæ­£äº¤çŸ©é˜µï¼Œæ‰€ä»¥$(\boldsymbol{W}\boldsymbol{U}^T\boldsymbol{R})$ä¹Ÿæ˜¯æ­£äº¤çŸ©é˜µï¼Œè®°ä¸º$V^T$ã€‚ é‚£ä¹ˆ$\boldsymbol{U}\boldsymbol{D}_{-k,-k,0}\boldsymbol{V}^T$å°±æ˜¯Eçš„SVDåˆ†è§£ã€‚    
ä¸Šè¿°çš„æ¨å¯¼å¾—åˆ°$\boldsymbol{E} = \boldsymbol{U}\boldsymbol{D}_{0,0,1}(\boldsymbol{W}\boldsymbol{U}^T\boldsymbol{R})$,çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¿½ç•¥äº†ç¬¦å·å’Œå°ºåº¦çš„ä½œç”¨ã€‚ å¦‚æœæœ¬è´¨çŸ©é˜µåˆ†è§£ä¸º$\boldsymbol{E} = \boldsymbol{U}\boldsymbol{D}_{1,1,0}\boldsymbol{V}^T$çš„å½¢å¼ï¼Œ é‚£ä¹ˆE=SRæœ‰ä¸¤ç§å¯èƒ½çš„åˆ†è§£ï¼š    
$$
\text{(1)}
        \begin{cases}
            \boldsymbol{S} = \boldsymbol{UZU^T} \\
            \boldsymbol{R} = \boldsymbol{UWV^T}
        \end{cases}
$$
$$
        \text{(2)}
        \begin{cases}
            \boldsymbol{S} = \boldsymbol{UZU^T} \\
            \boldsymbol{R} = \boldsymbol{UW^TV^T}
        \end{cases}
$$
å› ä¸ºåœ¨å¿½ç•¥ç¬¦å·çš„ä½œç”¨çš„æƒ…å†µä¸‹ï¼Œ$\boldsymbol{D}_{1,1,0}\boldsymbol{W}$ä¸$\boldsymbol{D}_{1,1,0}\boldsymbol{W}^T$çš„ä½œç”¨ä¸€æ ·ã€‚ ä¸Šå¼ä¸­çš„Rç¡®å®šäº†ç›¸æœºçš„å§¿æ€çŸ©é˜µã€‚å¿½ç•¥å°ºåº¦å› å­çš„ä½œç”¨æ—¶ï¼Œä¸Šå¼ä¸­$\boldsymbol{S} = \boldsymbol{UZU^T}$,ç¡®å®šäº†ç›¸æœºçš„å¹³ç§»å‘é‡ã€‚ å› ä¸ºå‘é‡å¯¹è‡ªèº«çš„å‰ç§¯ä¸ºé›¶ï¼Œå³$St=\mathbf{t}^{\wedge}t=0$ï¼Œå› æ­¤$\boldsymbol{t}=\boldsymbol{U}\begin{bmatrix} 0 & 0 & 1\end{bmatrix}^T = \boldsymbol{u_3}$,**å³çŸ©é˜µUçš„æœ€åä¸€åˆ—**ã€‚
$$
\left(U
\left[\begin{array}{c}
0 \\
0 \\
1
\end{array}\right]\right)^{\wedge}=
U
\left[\begin{array}{c}
0 &-1 &0  \\
1 &0 &0  \\
0 &0 &0
\end{array}\right]U^T \tag{1.5}
$$
ä½†æ˜¯å› ä¸ºEçš„ç¬¦å·ä¸èƒ½ç¡®å®šï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½ç¡®å®štç¬¦å·ã€‚ å› æ­¤ç›¸æœºçš„ä½å§¿å…±æœ‰å››ç§å¯èƒ½ï¼š
$$
\begin{equation}
        \begin{array}{c}
            \begin{bmatrix} \boldsymbol{UWV^T} | \boldsymbol{u_3} \end{bmatrix}  &
            \begin{bmatrix} \boldsymbol{UWV^T} | -\boldsymbol{u_3} \end{bmatrix} &
            \begin{bmatrix} \boldsymbol{UW^TV^T} | \boldsymbol{u_3} \end{bmatrix} & 
            \begin{bmatrix} \boldsymbol{UW^TV^T} | -\boldsymbol{u_3} \end{bmatrix} &
        \end{array}
        \end{equation}
$$   
åœ¨è¿™4ä¸­å¯èƒ½ä¸­ï¼Œåªæœ‰ä¸€ç§è§£èƒ½å¤Ÿä¿è¯ç‰¹å¾ç‚¹ä½äºåœ¨ä¸¤ä¸ªç›¸æœºçš„å‰é¢ï¼Œæ—¢æ·±åº¦å€¼ä¸ºæ­£çš„ã€‚æŠŠå„ä¸ªåŒ¹é…ç‚¹å¯¹ä»£è¿›å»åˆ†è´æ£€æµ‹ä¸€éï¼Œå°±å¯ä»¥æ‰¾å‡ºæ­£ç¡®çš„é‚£ä¸ªã€‚æ‰‹å†™æ¨å¯¼å¦‚ä¸‹ï¼š
![ReconstructF](./orbslam_images/GetImage52.png)
ä»¤ W è¡¨ç¤ºæ²¿ Z è½´æ—‹è½¬ 90Â° å¾—åˆ°çš„æ—‹è½¬çŸ©é˜µ
$$
\mathbf{W}=\mathbf{R}_z(\frac{\pi}{2}) = \begin{bmatrix}
        0 &  -1& 0\\ 
        1 & 0 & 0\\ 
        0 & 0 & 1
        \end{bmatrix}
$$
å¯¹äºä»»æ„ä¸€ä¸ª Eï¼Œå¯¹å®ƒåˆ†è§£éƒ½èƒ½å¾—åˆ°ä¸¤ä¸ªä¸ä¹‹å¯¹åº”çš„ R å’Œ t ï¼Œæ‰€ä»¥ä¸€å…±å­˜åœ¨ 4 ç»„è§£
$$
\begin{align}
\mathbf{t}_1^{\wedge} = \mathbf{U} \mathbf{R}_z(\frac{\pi}{2}) \mathbf{\Sigma} \mathbf{U}^T = U_3, & \ \mathbf{R}_1 = \mathbf{U} \mathbf{R}^T_z(\frac{\pi}{2}) \mathbf{V}^T \\
\mathbf{t}_2^{\wedge} = \mathbf{U} \mathbf{R}_z(-\frac{\pi}{2}) \mathbf{\Sigma} \mathbf{U}^T = -U_3, & \ \mathbf{R}_2 = \mathbf{U} \mathbf{R}^T_z(-\frac{\pi}{2}) \mathbf{V}^T \\
\end{align}
$$
å…¶ä¸­$\mathbf{R}_z(\frac{\pi}{2})$ï¼Œè¡¨ç¤ºæ²¿Zè½´æ—‹è½¬90åº¦çš„æ—‹è½¬çŸ©é˜µã€‚å¯¹æ¯”ä¸Šé¢ä¸¤ä¸ªå¼å­å¯ä»¥å‘ç°ï¼Œè¿™ä¸¤ç»„è§£å…¶å®æ˜¯ä»¥å‚è€ƒå¸§ä¸ºä¸­å¿ƒï¼Œç»•Zè½´å‘ˆ180åº¦æ—‹è½¬å¯¹ç§°çš„ä¸¤ç»„è§£ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º
![alt text](image-9.png) 
 
åŒæ—¶ï¼Œç”±äºæœ¬è´¨çŸ©é˜µEå¯ä»¥å–ä»»æ„ç¬¦å·ï¼Œå³Eå’Œ-Eæ˜¯ç­‰ä»·çš„ï¼Œæ‰€ä»¥å¯¹ä»»æ„ä¸€ä¸ªEå–è´Ÿå·åˆå–å¾—ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„è§£ï¼Œæ‰€ä»¥ä¸€å…±æœ‰å››ç»„ç¬¦åˆæ¡ä»¶çš„è§£ã€‚
æˆ‘ä»¬å¯ä»¥å°†ä»»æ„ä¸€å¯¹ç‰¹å¾ç‚¹ä»£å…¥æ‰€å–å¾—çš„4ç»„è§£ä¸­ï¼Œæ£€æµ‹è¯¥ç‚¹åœ¨ä¸¤ä¸ªç›¸æœºä¸‹çš„æ·±åº¦å€¼ã€‚æ˜¾ç„¶ç‰©æ–¹ç‰¹å¾ç‚¹åº”è¯¥ä½äºä¸¤ä¸ªç›¸æœºçš„å‰æ–¹ï¼Œå–ä¸¤ä¸ª**æ·±åº¦å€¼éƒ½ä¸ºæ­£çš„è§£**å³æ˜¯æ­£ç¡®çš„è§£ã€‚

### æ£€æŸ¥Rå’Œt
#### æ£€æŸ¥3Dç‚¹å’Œä¸¤ä¸ªç›¸æœºçš„è§†å·® 
![](./orbslam_images/GetImage54.png)
#### æ£€æŸ¥3Dç‚¹çš„æ·±åº¦ 
![](./orbslam_images/GetImage55.png)
#### æ£€æŸ¥3Dç‚¹åœ¨ä¸¤ä¸ªç›¸æœºçš„é‡æŠ•å½±è¯¯å·®
åœ¨è¯¯å·®å…è®¸èŒƒå›´å†…çš„è®¡ç®—å†…ç‚¹æ•°ï¼Œå¤§äºé˜ˆå€¼èˆå¼ƒæ”¹ç»„Rå’Œt

## å•åº”çŸ©é˜µ 
å‡è®¾ä½¿ç”¨åŒä¸€ç›¸æœºåœ¨ä¸åŒçš„ä½å§¿æ‹æ‘„åŒä¸€å¹³é¢ï¼Œå¦‚ä¸‹å›¾ï¼š
![alt text](image-10.png)  
ä¸Šå›¾è¡¨ç¤ºåœºæ™¯ä¸­çš„å¹³é¢$\pi$åœ¨ä¸¤ç›¸æœºçš„æˆåƒï¼Œè®¾å¹³é¢$\pi$åœ¨ç¬¬ä¸€ä¸ªç›¸æœºåæ ‡ç³»ä¸‹çš„å•ä½æ³•å‘é‡ä¸ºNï¼Œå…¶åˆ°ç¬¬ä¸€ä¸ªç›¸æœºä¸­å¿ƒï¼ˆåæ ‡åŸç‚¹ï¼‰çš„è·ç¦»ä¸ºdï¼Œåˆ™å¹³é¢$\pi$å¯è¡¨ç¤ºä¸ºï¼š$N^TX_1 = d$ï¼Œè½¬æ¢ä¸‹å¯å¾—$\frac{1}{d}N^TX_1 = 1,\forall X_1 \in \pi$ï¼Œå…¶ä¸­$X_1$æ˜¯ä¸‰ç»´ç‚¹Xåœ¨ç¬¬ä¸€ç›¸æœºåæ ‡ç³»ä¸‹çš„åæ ‡ï¼Œå…¶åœ¨ç¬¬äºŒä¸ªç›¸æœºåæ ‡ç³»ä¸‹çš„åæ ‡ä¸º$X_2$ï¼Œåˆ™$X_2 = RX_1 + t$ã€‚å°†ä¸Šé¢å¼å­ç»“åˆèµ·æ¥ï¼š
$$
X_2 = RX_1 + t\frac{1}{d}N^TX_1=(R+t\frac{N^T}{d})X_1=H'X_1
$$
æ‰€ä»¥å°±å¾—åˆ°äº†åŒä¸€å¹³é¢ä¸¤ä¸ªä¸åŒç›¸æœºåæ ‡ç³»çš„å•åº”çŸ©é˜µ$H' = R+t\frac{N^T}{d}$
ä¸Šé¢å¾—åˆ°çš„å•åº”çŸ©é˜µç¬¬ä¸€ä¸ªç›¸æœºåæ ‡ç³»å–å¾—ï¼Œè¿˜éœ€è¦å°†å…¶å˜æ¢åˆ°æˆåƒå¹³é¢åæ ‡ç³»ä¸­ï¼Œå–å¾—ä¸¤å›¾åƒé—´çš„å•åº”çŸ©é˜µã€‚è®¾$x_1,x_2$ä¸ºXåœ¨ä¸¤å›¾åƒçš„åƒç‚¹åæ ‡ï¼Œ$x_1 = KX_1,x_2 = KX_2$,Kæ˜¯ç›¸æœºçš„å†…å‚æ•°ï¼Œä»£å…¥ä¸Šé¢æ±‚å¾—å•åº”å˜æ¢å…¬å¼
$$
K^{-1}x_2 = HK^{-1}x_1 \Longrightarrow x_2 = KH'K^{-1}x_1=K(R+t\frac{N^T}{d})K^{-1}x_1
$$
æ‰€ä»¥ï¼ŒåŒä¸€å¹³é¢å¾—åˆ°çš„ä¸¤ä¸ªå›¾åƒé—´çš„å•åº”çŸ©é˜µHä¸º$H = K(R+t\frac{N^T}{d})K^{-1}$
### è®¡ç®—å•åº”çŸ©é˜µ  
è®¡ç®—å•åº”æ€§çŸ©é˜µçš„å‡½æ•°å®šä¹‰åœ¨[TwoViewReconstruction::FindHomography()](../ORB_SLAM3/src/TwoViewReconstruction.cc)ã€‚
é’ˆå¯¹å¹³é¢åœºæ™¯ï¼Œæ ¹æ®æ‘„å½±å˜æ¢å…³ç³»å»ºç«‹äº†ä¸¤å¹…å›¾åƒä¹‹é—´å„ç‚¹çš„ä¸€ä¸€å¯¹åº”å…³ç³»ã€‚ è¿™ä¸ªæ˜ å°„å…³ç³»å¯ä»¥ç”¨ä¸€ä¸ª3Ã—3çš„é½æ¬¡çŸ©é˜µHæ¥è¡¨ç¤ºï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå•åº”çŸ©é˜µã€‚ å‡è®¾x,xâ€²åˆ†åˆ«æ˜¯åˆå§‹åŒ–è¿‡ç¨‹ä¸­çš„å‚è€ƒå¸§å’Œå½“å‰å¸§ä¸­åŒ¹é…çš„ä¸¤ä¸ªç‰¹å¾ç‚¹ï¼ŒKä¸ºç›¸æœºçš„å†…å‚ï¼Œè¢«è§‚æµ‹çš„å¹³é¢çš„æ³•å‘é‡æ˜¯Nï¼Œå¹³é¢åˆ°å‚è€ƒå¸§çš„è·ç¦»ä¸ºdï¼Œ å¯ä»¥æ¨å¯¼å‡ºx,xâ€²å­˜åœ¨å¦‚ä¸‹çš„å…³ç³»:
$$
\begin{equation}\
            \begin{array}{rl}
                            & \boldsymbol{x'} = \cfrac{z_1}{z_2}\boldsymbol{K}\left(\boldsymbol{R} + \boldsymbol{t}\cfrac{1}{d}\boldsymbol{N}^T\right)\boldsymbol{K}^{-1}\boldsymbol{x} \\
                \Rightarrow & \boldsymbol{x'} = s\boldsymbol{H}\boldsymbol{x}
            \end{array}
        \end{equation}
$$
å…¶ä¸­$\boldsymbol{H} = \boldsymbol{K}\left(\boldsymbol{R} + \boldsymbol{t}\cfrac{1}{d}\boldsymbol{N}^T\right)\boldsymbol{K}^{-1}$æ˜¯ä¸¤å¹…å›¾åƒçš„å•åº”çŸ©é˜µ,$s = z_1 / z_2$æ˜¯ä¸¤å¹…å›¾åƒä¹‹é—´çš„å°ºåº¦å› å­ã€‚    

$$
\begin{equation}\
            \begin{bmatrix} u_2 \\ v_2 \\ 1 \end{bmatrix} = s \begin{bmatrix} h_1 & h_2 & h_3 \\
                                                                              h_4 & h_5 & h_6 \\
                                                                              h_7 & h_8 & h_9 \end{bmatrix}
                                                            \begin{bmatrix} u_1 \\ v_1 \\ 1 \end{bmatrix}
        \end{equation}
$$   
å…¶ä¸­ï¼Œ$(u_2, v_2)$ä¸ºå½“å‰å¸§ä¸­ç‰¹å¾ç‚¹çš„åƒç´ åæ ‡ï¼Œ$(u_1, v_1)$ä¸ºå‚è€ƒå¸§ä¸­åŒ¹é…ç‚¹çš„åƒç´ åæ ‡ã€‚$h_1 \cdots h_9$æ˜¯çŸ©é˜µHä¸­çš„9ä¸ªå…ƒç´ ã€‚    
$$
\begin{cases}
            u_2 = s(h_1 u_1 + h_2 v_1 + h_3) \\
            v_2 = s(h_4 u_1 + h_5 v_1 + h_6) \\
              1 = s(h_7 u_1 + h_8 v_1 + h_9)
        \end{cases} \Rightarrow \begin{cases}
            u_2 = \frac{h_1 u_1 + h_2 v_1 + h_3}{h_7 u_1 + h_8 v_1 + h_9} \\
            v_2 = \frac{h_4 u_1 + h_5 v_1 + h_6}{h_7 u_1 + h_8 v_1 + h_9}
        \end{cases}
$$    
ä¸€å¯¹åŒ¹é…ç‚¹æˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸Šå¼å†™å‡ºä¸¤ä¸ªçº¦æŸï¼Œæ•´ç†ä¸Šå¼æœ‰ï¼š    
$$
\begin{cases}
            h_1 u_1 + h_2 v_1 + h_3 - h_7 u_1 u_2 - h_8 v_1 u_2 - u_2 = 0 \\
            h_4 u_1 + h_5 v_1 + h_6 - h_7 u_1 v_2 - h_8 v_1 v_2 - v_2 = 0
        \end{cases}
$$    
å‡è®¾æˆ‘ä»¬æœ‰ m å¯¹åŒ¹é…ç‚¹ï¼Œæ ¹æ®ä¸Šå¼æˆ‘ä»¬å¯ä»¥å†™å‡º 2m ä¸ªçº¦æŸï¼Œå¯ä»¥å†™æˆ $A\hat{H} = \boldsymbol{0}$çš„çŸ©é˜µå½¢å¼ï¼Œå¦‚ä¸‹ï¼Œç”±äºå°ºåº¦å› å­çš„å­˜åœ¨ï¼Œæ±‚è§£æ—¶ä¸€èˆ¬è®¤ä¸º$h_9=1$ï¼Œæ‰€ä»¥å‘é‡$\hat{H}$ä¸­åªæœ‰8ä¸ªæœªçŸ¥æ•°ï¼Œè‡³å°‘éœ€è¦4å¯¹åŒ¹é…ç‚¹ï¼Œå†™å‡º8ä¸ªçº¿æ€§æ–¹ç¨‹æ‰å¯ä»¥æ±‚è§£ï¼Œ**ç›´æ¥çº¿æ€§å˜æ¢æ³•ï¼ˆDirect Linear Transformï¼‰**ã€‚

### å•åº”çŸ©é˜µçš„åˆ†è§£ 
å•åº”æ€§çŸ©é˜µåˆ†è§£çš„å‡½æ•°å®šä¹‰åœ¨[TwoViewReconstruction::ReconstructH()](../ORB_SLAM3/src/TwoViewReconstruction.cc)ã€‚   
ä¸‹å›¾è¡¨ç¤ºåœºæ™¯ä¸­çš„å¹³é¢Måœ¨ä¸¤ç›¸æœºçš„æˆåƒï¼Œè®¾å¹³é¢Måœ¨ç¬¬ä¸€ä¸ªç›¸æœºåæ ‡ç³»ä¸‹çš„å•ä½æ³•å‘é‡ä¸ºNï¼Œå…¶åˆ°ç¬¬ä¸€ä¸ªç›¸æœºä¸­å¿ƒï¼ˆåæ ‡åŸç‚¹ï¼‰çš„è·ç¦»ä¸ºdï¼Œåˆ™å¹³é¢Må¯è¡¨ç¤ºä¸ºï¼š$N^TX_1 = d$  
$\frac{1}{d}N^TX_1 = 1,\forall X_1 \in \pi$  è½¬æ¢ä¸‹
å…¶ä¸­ï¼Œ$X_1$æ˜¯ä¸‰ç»´ç‚¹Påœ¨ç¬¬ä¸€ç›¸æœºåæ ‡ç³»ä¸‹çš„åæ ‡ï¼Œå…¶åœ¨ç¬¬äºŒä¸ªç›¸æœºåæ ‡ç³»ä¸‹çš„åæ ‡ä¸º$X_2$ï¼Œåˆ™
$X_2 = RX_1 + T$   
å°†ä¸Šé¢å¼å­ç»“åˆèµ·æ¥ï¼Œ   
$X_2 = RX_1 + T\frac{1}{d}N^TX_1=(R+T\frac{1}{d}N^T)X_1=H'X_1$  
æ‰€ä»¥å°±å¾—åˆ°äº†åŒä¸€å¹³é¢ä¸¤ä¸ªä¸åŒç›¸æœºåæ ‡ç³»çš„å•åº”çŸ©é˜µ
$H' = R+T\frac{1}{d}N^T$
![alt text](./orbslam_images/image_zero.png)    
![alt text](./orbslam_images/image.png)    
![alt text](./orbslam_images/image-1.png)   
![alt text](./orbslam_images/image-2.png)   
![alt text](./orbslam_images/image-3.png)   
ORB-SLAM2 åªå¤„ç† $d_1>d_2>d_3$ çš„æƒ…å†µï¼Œæ ¹æ®$d', \varepsilon_1, \varepsilon_3$çš„ç¬¦å·ä¸€å…±æœ‰ 8 ç§ä¸åŒçš„è§£ã€‚ ä¸‹é¢æˆ‘ä»¬è¯¦ç»†åˆ†æå‡½æ•° ReconstructHï¼Œäº†è§£å…·ä½“çš„å®ç°è¿‡ç¨‹ã€‚  
## ä¸‰è§’æµ‹é‡åŸç†    
å‡½æ•°çš„å®šä¹‰åœ¨[GeometricTools::Triangulate()](../ORB_SLAM3/src/GeometricTools.cc)ï¼Œ**å‡½æ•°ä½œç”¨æ˜¯æ ¹æ®æ±‚å¾—Rå’Œtæ±‚è§£å‡º3Dç‚¹**ï¼Œç°åœ¨å‡è®¾ç›¸æœºçš„å†…å‚çŸ©é˜µä¸ºKï¼Œæ ¹æ®å•åº”çŸ©é˜µæˆ–è€…åŸºç¡€çŸ©é˜µä¼°è®¡å‡ºç›¸æœºçš„æ—‹è½¬çŸ©é˜µRå’Œå¹³ç§»å‘é‡tã€‚é‚£ä¹ˆå¯¹äºç©ºé—´ä¸­ä¸€ç‚¹$\boldsymbol{X} = \begin{bmatrix} x & y & z \end{bmatrix}^T$ï¼Œ å…¶åœ¨ç›¸æœºä¸­çš„æˆåƒç‚¹$\boldsymbol{x} = \begin{bmatrix} u & v & 1 \end{bmatrix}^T$ ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å†™å‡º3Dåæ ‡åˆ°2Dåƒç´ ä¹‹é—´çš„æŠ•å½±å…³ç³»ï¼š   
$$
\boldsymbol{x} = \cfrac{1}{z} \boldsymbol{K} [\boldsymbol{R} | \boldsymbol{t}] \boldsymbol{X} 
$$

$$
\begin{bmatrix} u \\ v \\ 1 \end{bmatrix} = \cfrac{1}{s} \begin{bmatrix}
                                            f_x & 0   & c_x \\
                                                0 & f_y & c_y \\
                                                0 & 0   & 1 \end{bmatrix}
\begin{bmatrix}
    r_{11} & r_{12} & r_{13} & t_x \\
    r_{21} & r_{22} & r_{23} & t_y \\
    r_{31} & r_{32} & r_{33} & t_z \\
\end{bmatrix}
\begin{bmatrix} x \\ y \\ z \\ 1 \end{bmatrix}
$$  
ä¸Šå¼ä¸­ç¬¦å·$s = r_{31} x + r_{32} y + r_{33} z + t_z$ä¸ºç©ºé—´ä¸­çš„ç‚¹Xåœ¨ç» [R|t]å˜æ¢ä¹‹åå¾—åˆ°çš„ç‚¹åˆ°ç›¸æœºçš„è·ç¦»ã€‚ æˆ‘ä»¬æŠŠçŸ©é˜µ$K[R|t]$ç§°ä¸ºç©ºé—´ç‚¹åˆ°åƒç´ ç‚¹çš„æŠ•å½±çŸ©é˜µæ¥è¡¨ç¤ºã€‚ è‹¥å‚è€ƒå¸§çš„æŠ•å½±çŸ©é˜µä¸º$P$ï¼Œç©ºé—´ç‚¹$X$åœ¨å…¶ä¸­çš„æŠ•å½±åƒç´ ä¸º$x$ï¼Œé‚£ä¹ˆå…¶æŠ•å½±å…³ç³»å¯ä»¥è®°ä¸º$\boldsymbol{x} = \frac{1}{s}\boldsymbol{PX}$ã€‚ è®¾å½“å‰å¸§çš„æŠ•å½±çŸ©é˜µä¸º$\boldsymbol{P'}$ï¼Œç©ºé—´ç‚¹$X$åœ¨å…¶ä¸­çš„æŠ•å½±åƒç´ ä¸º$xâ€²$ï¼Œé‚£ä¹ˆå…¶æŠ•å½±å…³ç³»å¯ä»¥è®°ä¸º$\boldsymbol{x'} = \frac{1}{s'}\boldsymbol{P'X}$ã€‚ ç°åœ¨æˆ‘ä»¬çš„ç›®æ ‡æ˜¯è¦æ ¹æ®è¿™ä¸¤å¸§çš„åƒç´ ç‚¹åæ ‡æ¥ä¼°è®¡ç©ºé—´ç‚¹Xçš„åæ ‡ã€‚    
ORB-SLAM2ä¸­é‡‡ç”¨äº†ä¸€ç§çº¿æ€§ä¸‰è§’å½¢çš„æ–¹æ³•è¿›è¡Œæ±‚è§£çš„ï¼Œå…¶æ€è·¯ä¸æ±‚è§£å•åº”çŸ©é˜µçš„DLTç®—æ³•ä¸€æ ·ï¼Œ ä¹Ÿæ˜¯å°†ä¸¤ä¸ªç‚¹çš„çº¦æŸæ„å»ºæˆ$AX=0$çš„å½¢å¼ï¼Œç„¶åå¯¹çŸ©é˜µAè¿›è¡ŒSVDåˆ†è§£ï¼Œå–é›¶ç©ºé—´çš„ç‰¹å¾å‘é‡ä½œä¸ºXçš„ä¼°è®¡ã€‚ æˆ‘ä»¬å°†åƒç´ ç‚¹åæ ‡å‰ä¹˜åˆ°æŠ•å½±æ–¹ç¨‹çš„ä¸¤ä¾§ï¼Œå¯ä»¥å»é™¤æ‰å°ºåº¦å› å­ã€‚
å¯¹ä¸Šè¿°çŸ©é˜µAè¿›è¡ŒSVDåˆ†è§£ï¼Œå–VçŸ©é˜µçš„æœ€åä¸€åˆ—å°±æ˜¯Xã€‚å› ä¸ºåœ¨ORB-SLAM2ä¸­ï¼Œåœ°å›¾åæ ‡ç³»æ˜¯ä»¥åˆå§‹åŒ–æ—¶çš„å‚è€ƒå¸§ä¸ºåŸºå‡†æ„å»ºçš„ï¼Œ æ‰€ä»¥å‚è€ƒå¸§çš„æŠ•å½±çŸ©é˜µä¸º$P=K[I|0]$ã€‚  
$$
\boldsymbol{x} \times \boldsymbol{PX} = \boldsymbol{0} \Rightarrow \begin{cases}
            (u P_3^T - P_1^T) \boldsymbol{X} = 0 \\
            (v P_3^T - P_2^T) \boldsymbol{X} = 0 \\
            (u P_2^T - vP_1^T) \boldsymbol{X} = 0 \\
        \end{cases}
        ,
        \boldsymbol{x'} \times \boldsymbol{P'X} = \boldsymbol{0} \Rightarrow \begin{cases}
            (u' {P'}_3^T -   {P'}_1^T) \boldsymbol{X} = 0 \\
            (v' {P'}_3^T -   {P'}_2^T) \boldsymbol{X} = 0 \\
            (u' {P'}_2^T - v'{P'}_1^T) \boldsymbol{X} = 0 \\
        \end{cases}
$$
ä¸Šå¼ä¸­ï¼Œ**$P_i$ä¸ºæŠ•å½±çŸ©é˜µä¸­çš„ç¬¬iè¡Œ**ã€‚ä»ä¸Šå¼ä¸­æ¯å¸§å›¾åƒçš„åƒç´ ç‚¹ä¸Šå–ä¸¤ä¸ªçº¦æŸï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªå…³äº4ä¸ªé½æ¬¡åæ ‡çš„4ä¸ªæ–¹ç¨‹$AX=0$ï¼Œå…¶ä¸­:
$$
\begin{equation}
        \boldsymbol{A} = \begin{bmatrix}
            u P_3^T - P_1^T \\
            v P_3^T - P_2^T \\
            u' {P'}_3^T - {P'}_1^T \\
            v' {P'}_3^T - {P'}_2^T
        \end{bmatrix}
        \end{equation}
$$   
```C++ 
/** 
 * @brief ä¸‰è§’åŒ–è·å¾—ä¸‰ç»´ç‚¹(åˆå§‹åŒ–ç”¨çš„)
 * @param x_c1 ç‚¹åœ¨å…³é”®å¸§1
 * @param x_c2 ç‚¹åœ¨å…³é”®å¸§2
 * @param Tc1w å…³é”®å¸§1æŠ•å½±çŸ©é˜µ  Camera 1 Projection Matrix K[I|0]
 * @param Tc2w å…³é”®å¸§2æŠ•å½±çŸ©é˜µ  Camera 2 Projection Matrix K[R|t]
 * @param x3D ä¸‰ç»´ç‚¹åæ ‡ï¼Œä½œä¸ºç»“æœè¾“å‡º
 */
bool GeometricTools::Triangulate(
    Eigen::Vector3f &x_c1, Eigen::Vector3f &x_c2, Eigen::Matrix<float,3,4> &Tc1w, Eigen::Matrix<float,3,4> &Tc2w,
    Eigen::Vector3f &x3D)
{
    Eigen::Matrix4f A;
    // x = a*P*Xï¼Œ å·¦å³ä¸¤é¢ä¹˜Pcçš„åå¯¹ç§°çŸ©é˜µ a*[x]^ * P *X = 0 æ„æˆäº†AçŸ©é˜µï¼Œä¸­é—´æ¶‰åŠä¸€ä¸ªå°ºåº¦aï¼Œå› ä¸ºéƒ½æ˜¯å½’ä¸€åŒ–å¹³é¢ï¼Œä½†å³é¢æ˜¯0æ‰€ä»¥ç›´æ¥å¯ä»¥çº¦æ‰ä¸å½±å“æœ€åçš„å°ºåº¦
    A.block<1,4>(0,0) = x_c1(0) * Tc1w.block<1,4>(2,0) - Tc1w.block<1,4>(0,0);
    A.block<1,4>(1,0) = x_c1(1) * Tc1w.block<1,4>(2,0) - Tc1w.block<1,4>(1,0);
    A.block<1,4>(2,0) = x_c2(0) * Tc2w.block<1,4>(2,0) - Tc2w.block<1,4>(0,0);
    A.block<1,4>(3,0) = x_c2(1) * Tc2w.block<1,4>(2,0) - Tc2w.block<1,4>(1,0);

    // è§£æ–¹ç¨‹ AX=0
    Eigen::JacobiSVD<Eigen::Matrix4f> svd(A, Eigen::ComputeFullV);

    Eigen::Vector4f x3Dh = svd.matrixV().col(3);

    if(x3Dh(3)==0)
        return false;
    // æ±‚å‡ºçš„æ˜¯4ç»´çš„ç»“æœ[X,Y,Z,A]ï¼Œæ‰€ä»¥éœ€è¦é™¤ä»¥æœ€åä¸€ç»´ä½¿ä¹‹ä¸º1ï¼Œå°±æˆäº†[X,Y,Z,1]è¿™ç§é½æ¬¡å½¢å¼Euclidean coordinates 
    x3D = x3Dh.head(3)/x3Dh(3);

    return true;
}
```
## PnPé—®é¢˜
PnP é—®é¢˜(Perspective-n-Point Problem)æ˜¯ï¼Œå·²çŸ¥ç›¸æœºå†…å‚çŸ©é˜µKå’Œ n ä¸ª 3D ç©ºé—´ç‚¹${c_1,c_2,â‹¯,c_n}$åŠå…¶åˆ°å›¾åƒä¸Š 2D çš„æŠ•å½±ç‚¹${Î¼_1,Î¼_2,â‹¯,Î¼_n}$ï¼Œæ±‚è§£ç›¸æœºçš„ä½ç½®å’Œå§¿æ€ã€‚è®°ç¬¬ i ä¸ª 3D ç©ºé—´ç‚¹çš„é½æ¬¡åæ ‡ä¸º $\boldsymbol{c_i} = \begin{bmatrix} x_i & y_i & z_i & 1\end{bmatrix}^T$ï¼Œå…¶åœ¨å›¾åƒä¸ŠæŠ•å½±çš„ 2D åƒç´ åæ ‡ä¸º $\boldsymbol{\mu_i} = \begin{bmatrix} u_i & v_i & 1 \end{bmatrix}^T$ã€‚ å…¶æŠ•å½±è¿‡ç¨‹ï¼Œå¯ä»¥åˆ†è§£ä¸ºä¸¤æ­¥ï¼š    
1. æ ¹æ®ç›¸æœºçš„ä½å§¿ï¼Œå°†ç©ºé—´ç‚¹ä»ä¸–ç•Œåæ ‡ç³»ä¸‹å˜æ¢åˆ°ç›¸æœºåæ ‡ç³»ä¸‹ã€‚
2. å°†ç›¸æœºåæ ‡ç³»ä¸‹çš„ç‚¹ï¼Œæ ¹æ®ç›¸æœºå†…å‚çŸ©é˜µï¼ŒæŠ•å½±åˆ°å›¾åƒä¸Šã€‚     
![alt text](./orbslam_images/image-5.png)  
å…¶æ•´ä¸ªè¿‡ç¨‹ç›¸å½“äºè¿ç»­ä¹˜äº†ä¸¤ä¸ªçŸ©é˜µï¼š   
$$
s \begin{bmatrix} u_i \\ v_i \\ 1 \end{bmatrix} = \boldsymbol{K} \left[ \boldsymbol{R} \big | \boldsymbol{t} \right]
                                                        \begin{bmatrix} x_i \\ y_i \\ z_i \\ 1 \end{bmatrix}
        = \begin{bmatrix} f_x & 0 & c_x \\ 0 & f_y & c_y \\ 0 & 0 & 1 \end{bmatrix}
          \begin{bmatrix} t_1 & t_2 & t_3 & t_4 \\
                          t_5 & t_6 & t_7 & t_8 \\
                          t_9 & t_{10} & t_{11} & t_{12} \end{bmatrix}
          \begin{bmatrix} x_i \\ y_i \\ z_i \\ 1 \end{bmatrix}
$$   
å…¶ä¸­ï¼Œsæ˜¯ä¸€ä¸ªå°ºåº¦ç³»æ•°ï¼Œåœ¨è®¡ç®—æ—¶é€šå¸¸é€šè¿‡å‰ä¹˜æˆ–è€…å½’ä¸€åŒ–å°†ä¹‹æ¶ˆé™¤æ‰ã€‚K,R,tåˆ†åˆ«æ˜¯ç›¸æœºçš„å†…å‚çŸ©é˜µã€å§¿æ€çŸ©é˜µå’Œä½ç½®å‘é‡ã€‚ å‚ç…§å•åº”çŸ©é˜µå’ŒåŸºç¡€çŸ©é˜µçš„æ±‚è§£è¿‡ç¨‹ï¼Œ æˆ‘ä»¬ç”¨çŸ©é˜µ$A=K[Râˆ£t]$å°†ä¸Šå¼æ”¹å†™ä¸º:   
$$
s \begin{bmatrix} u_i \\ v_i \\ 1 \end{bmatrix} = \underbrace{\begin{bmatrix}
                           a_1 & a_2    & a_3    & a_4 \\
                           a_5 & a_6    & a_7    & a_8 \\
                           a_9 & a_{10} & a_{11} & a_{12}
                        \end{bmatrix}}_{\boldsymbol{A}} \begin{bmatrix} x_i \\ y_i \\ z_i \\ 1 \end{bmatrix}
        \Rightarrow
$$  
$$
        \begin{cases}
            u_i = \frac{ a_1 x_i + a_2 y_i + a_3 z_i + a_4 }{ a_9 x_i + a_{10} y_i + a_{11}z_i + a_{12} } \\
            v_i = \frac{ a_5 x_i + a_6 y_i + a_7 z_i + a_8 }{ a_9 x_i + a_{10} y_i + a_{11}z_i + a_{12} }
        \end{cases}
        \Rightarrow
$$
$$
        \begin{bmatrix}
            x_i & y_i & z_i & 1 & 0 & 0 & 0 & 0 & -x_i & -y_i & -z_i & -1 \\
            0 & 0 & 0 & 0 & x_i & y_i & z_i & 1 & -x_i & -y_i & -z_i & -1
        \end{bmatrix}
        \begin{bmatrix}
            a_1 \\ a_2 \\ \vdots \\ a_{11} \\ a_{12}
        \end{bmatrix} = \boldsymbol{0}
$$   
å¦‚æ­¤ï¼Œå¯¹äº n ä¸ªåŒ¹é…ç‚¹å¯¹ï¼Œå°±å¯ä»¥å¾—åˆ°ä¸‹é¢å½¢å¼çš„çº¿æ€§æ–¹ç¨‹ç»„ã€‚SVDåˆ†è§£ï¼Œè§£é›¶ç©ºé—´ï¼Œå°±å¯ä»¥è§£å¾—çŸ©é˜µAã€‚ æœ€å°‘6ä¸ªåŒ¹é…ç‚¹å¯¹ï¼Œå°±å¯ä»¥å®Œæˆæ±‚è§£ã€‚è¿™å°±æ˜¯ä¸€ä¸ªDLT(Direct Linear Transformation)çš„æ–¹æ³•ã€‚   
$$
\begin{bmatrix}
            x_0 & y_0 & z_0 & 1 & 0 & 0 & 0 & 0 & -x_0 & -y_0 & -z_0 & -1 \\
            0 & 0 & 0 & 0 & x_0 & y_0 & z_0 & 1 & -x_0 & -y_0 & -z_0 & -1 \\
            \vdots & \vdots & \vdots & \vdots & \vdots & \vdots & \vdots & \vdots & \vdots & \vdots & \vdots & \vdots \\
            x_{n-1} & y_{n-1} & z_{n-1} & 1 & 0 & 0 & 0 & 0 & -x_{n-1} & -y_{n-1} & -z_{n-1} & -1 \\
            0 & 0 & 0 & 0 & x_{n-1} & y_{n-1} & z_{n-1} & 1 & -x_{n-1} & -y_{n-1} & -z_{n-1} & -1
        \end{bmatrix}
        \begin{bmatrix}
            a_1 \\ a_2 \\ \vdots \\ a_{11} \\ a_{12}
        \end{bmatrix} = \boldsymbol{0}
$$    
å½“ç„¶ä¸Šè¿°DLTç®—æ³•è§£å¾—çš„æ˜¯çŸ©é˜µAï¼Œå®ƒåŒ…å«äº†ç›¸æœºå†…å‚Kã€å§¿æ€çŸ©é˜µRå’Œå¹³ç§»å‘é‡tã€‚ è¿›ä¸€æ­¥çš„ï¼Œé€šè¿‡QRåˆ†è§£ï¼Œå¯ä»¥ä»çŸ©é˜µAä¸­æŠŠè¿™ä¸‰ä¸ªéƒ½ç»™åˆ†è§£å‡ºæ¥ã€‚çœ‹èµ·æ¥è¿™ä¸€è¿‡ç¨‹è¿˜é™„å¸¦ç®—å‡ºäº†ç›¸æœºçš„å†…å‚ï¼Œè¿™ä¹Ÿæ­£æ˜¯ç›¸æœºçš„å†…å‚æ ‡å®šçš„æ±‚è§£è¿‡ç¨‹ã€‚ DLTç®—æ³•ç®€å•ç›´æ¥ï¼Œä½†æ˜¯å®ƒå¿½ç•¥äº†å¤ªå¤šçš„çº¦æŸï¼Œæ‰€ä»¥ç»“æœä¸€èˆ¬éƒ½ä¸ä¼šå¾ˆå¥½ã€‚åæ¥äººä»¬è¿˜ç ”ç©¶å‡ºäº†å¾ˆå¤šæ±‚è§£ PnP é—®é¢˜çš„ç®—æ³•ï¼Œæœ‰åªéœ€è¦3ä¸ªç‚¹å°±å¯ä»¥æ±‚è§£çš„P3Pç®—æ³•ã€‚ ORB-SLAM2 ç”¨çš„å°±æ˜¯EPnPç®—æ³•ï¼Œæ•ˆç‡é«˜è€Œä¸”ç¨³å®šï¼Œæ®è¯´å…¶ç®—æ³•å¤æ‚åº¦æ˜¯ O(n) çš„ã€‚      
æä¾›äº†ä¸‰ç§ä¼°è®¡ç›¸æœºä½å§¿çš„æ–¹å¼ï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹ä»¥åŒ€é€Ÿè¿åŠ¨æ¨¡å‹ä¼°è®¡ç›¸æœºä½å§¿ï¼›å¦‚æœè·Ÿä¸¢äº†ï¼Œå…ˆé€šè¿‡å‚è€ƒå…³é”®å¸§ä¼°è®¡ç›¸æœºä½å§¿ï¼› å¦‚æœè¿™æ ·æ— æ³•æ¢å¤ï¼Œåˆ™å°è¯•è¿›è¡Œé‡å®šä½ã€‚é‡å®šä½çš„è¿‡ç¨‹å¯ä»¥çœ‹åšæ˜¯ä»å†å²çš„å…³é”®å¸§ä¸­æœç´¢å‡ºä¸€ä¸ªæœ€æœ‰å¸Œæœ›çš„ä½œä¸ºæ–°çš„å‚è€ƒå…³é”®å¸§ä¼°è®¡ç›¸æœºä½å§¿ã€‚ 
è·Ÿè¸ªä½¿ç”¨è¿åŠ¨æ¨¡å‹çš„**Tracking::TrackWithMotionModel()**ï¼Œä½¿ç”¨ä¸Šä¸€å¸§mLastFrameçš„3Dç‚¹äº‘æ¥pnpæ±‚è§£[matcher.SearchByProjection(mCurrentFrame,mLastFrame](../ORB_SLAM3/src/ORBmatcher.cc);è·Ÿè¸ªå‚è€ƒå…³é”®å¸§çš„**Tracking::TrackReferenceKeyFrame()**ï¼Œä½¿ç”¨æœ€è¿‘çš„å‚è€ƒå…³é”®å¸§çš„3Dç‚¹äº‘æ¥pnpæ±‚è§£[matcher.SearchByBoW(mpReferenceKF,mCurrentFrame](../ORB_SLAM3/src/ORBmatcher.cc);é‡å®šä½**Tracking::Relocalization()**ï¼Œä½¿ç”¨å†å²ä¸Šæ¯ä¸€ä¸ªå…³é”®å¸§pKFçš„3Dç‚¹äº‘pnpæ±‚è§£[matcher.SearchByBoW(pKF,mCurrentFrame](../ORB_SLAM3/src/ORBmatcher.cc);æœ€åä¸€ä¸ªæ˜¯è·Ÿè¸ªå±€éƒ¨åœ°å›¾**Tracking::TrackLocalMap()**ï¼Œä½¿ç”¨å±€éƒ¨åœ°å›¾çš„3Dç‚¹äº‘æ¥æ±‚è§£pnp[matcher.SearchByProjection(mCurrentFrame, mvpLocalMapPoints](../ORB_SLAM3/src/ORBmatcher.cc)ã€‚   
## é‡æŠ•å½±è¯¯å·®ä¸BAä¼˜åŒ–å‡½æ•°  
### é‡æŠ•å½±è¯¯å·® 
BA(Bundle Adjustment)ï¼Œåˆç§°å…‰æŸæ³•å¹³å·®ï¼ˆå¹³å·®å°±æ˜¯æŠ¹å¹³è¯¯å·®ï¼‰ã€‚BAçš„æœ¬è´¨æ˜¯ä¸€ä¸ªä¼˜åŒ–æ¨¡å‹ï¼Œå…¶ç›®çš„æ˜¯æœ€å°åŒ–é‡æŠ•å½±è¯¯å·®ï¼Œæ‰€è°“é‡æŠ•å½±è¯¯å·®å°±æ˜¯äºŒæ¬¡æŠ•å½±ä¸ä¸€æ¬¡æŠ•å½±ä¹‹é—´äº§ç”Ÿçš„è¯¯å·®ã€‚å®é™…å‡½æ•°å®šä¹‰åœ¨[Optimizer::BundleAdjustment()](../ORB_SLAM3/src/Optimizer.cc)ã€‚
![alt text](./orbslam_images/image-7.png)   
ç¬¬ä¸€æ¬¡æŠ•å½±æŒ‡çš„å°±æ˜¯ç›¸æœºåœ¨æ‹ç…§çš„æ—¶å€™ä¸‰ç»´ç©ºé—´ç‚¹æŠ•å½±åˆ°å›¾åƒä¸Šç¬¬ä¸€æ¬¡æŠ•å½±åœ¨ç›¸æœºå¹³é¢äº§ç”Ÿäº†ç‰¹å¾ç‚¹$p_1$ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºPçš„åæ ‡ä½ç½®ã€‚ä¹‹åç›¸æœºè¿›è¡Œäº†è¿åŠ¨ï¼Œé€šè¿‡ä¸€äº›æ–¹æ³•æˆ‘ä»¬å¾—åˆ°è¿™ä¸ªè¿åŠ¨çš„æ•°å€¼ï¼Œè¿›è€Œå¾—åˆ°äº†å®ƒçš„ä½å§¿ã€‚ç”±äºæˆ‘ä»¬ç°åœ¨çŸ¥é“ç›¸æœºçš„ä½å§¿ï¼ˆè®¡ç®—ä¼°è®¡å¾—æ¥ï¼‰å’ŒPçš„ä¸–ç•Œåæ ‡ï¼Œå› æ­¤å¯ä»¥è®¡ç®—Påœ¨ç¬¬äºŒå¹…å›¾ä¸‹çš„æŠ•å½±ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ç¬¬äºŒæ¬¡æŠ•å½±ã€‚æ­¤æ—¶åœ¨ç›¸æœºå¹³é¢äº§ç”Ÿäº†ç‰¹å¾ç‚¹$p_2$ï¼Œè€Œé€šè¿‡ç‰¹å¾åŒ¹é…æˆ‘ä»¬èƒ½å¤ŸçŸ¥é“ç‰¹å¾ç‚¹$\hat{p}_2$çš„çœŸå®ä½ç½®ï¼Œä¸¤è€…ä¼šäº§ç”Ÿè¯¯å·®ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„é‡æŠ•å½±è¯¯å·®ã€‚æ¢å¥è¯è¯´ï¼Œé‡æŠ•å½±è¯¯å·®æ˜¯æŒ‡çš„çœŸå®ä¸‰ç»´ç©ºé—´ç‚¹åœ¨å›¾åƒå¹³é¢ä¸Šçš„æŠ•å½±ï¼ˆä¹Ÿå°±æ˜¯å›¾åƒä¸Šçš„åƒç´ ç‚¹ï¼‰å’Œé‡æŠ•å½±ï¼ˆå…¶å®æ˜¯ç”¨æˆ‘ä»¬çš„è®¡ç®—å€¼å¾—åˆ°çš„è™šæ‹Ÿçš„åƒç´ ç‚¹ï¼‰çš„å·®å€¼ã€‚    
ç»™å®šNä¸ªä¸¤å¼ å›¾ä¸­å®ŒæˆåŒ¹é…çš„ç‚¹ï¼Œè®°ä½œï¼š  
${z_1} = \left\{ {z_1^1,z_1^2, \ldots ,z_1^N} \right\},{z_2} = \left\{ {z_2^1,z_2^2, \ldots ,z_2^N} \right\}$   
å·²çŸ¥ç›¸æœºçš„å†…å‚çŸ©é˜µä¸ºKï¼Œæ±‚è§£ç›¸æœºçš„è¿åŠ¨R,tï¼Œæ³¨æ„å­—ç¬¦zä¸Šæ ‡è¡¨ç¤ºç¬¬å‡ ä¸ªç‚¹ã€‚åˆ™ï¼š
$z_i^j=[u,v]_i^j$   
æ ¹æ®æŠ•å½±å…³ç³»:
$$
\begin{equation} {\lambda _1}\left[ \begin{array}{l} z_1^j\\ 1 \end{array} \right] = K{P^j},\quad {\lambda _2}\left[ \begin{array}{l} z_2^j\\ 1 \end{array} \right] = K\left( {R{P^j} + t} \right) \end{equation}
$$  
å·²çŸ¥è§‚æµ‹æ–¹ç¨‹ä¸º$z=h(x,y)$ï¼Œå…¶ä¸­xè¡¨ç¤ºä½å§¿ï¼Œyè¡¨ç¤ºè·¯æ ‡ã€‚è§‚æµ‹è¯¯å·®å°±å¯ä»¥è¡¨ç¤ºä¸ºï¼š  
$e=z-h(\xi,p)$   
zè¡¨ç¤ºä¸€æ¬¡æŠ•å½±å¾—åˆ°çš„ç‰¹å¾ç‚¹ä½ç½®ï¼Œ$h(\xi,p)$è¡¨ç¤ºäºŒæ¬¡æŠ•å½±çš„ç»“æœï¼Œhå°±æ˜¯æŠ•å½±å‡½æ•°ï¼ˆè¿™é‡Œç”¨æä»£æ•°è¡¨ç¤ºï¼Œpè¡¨ç¤ºä¸‰ç»´ç‚¹ï¼‰ã€‚å¦‚æœæŠŠæ‰€æœ‰è§‚æµ‹ç»“æœè€ƒè™‘è¿›æ¥ï¼Œç»™è¯¯å·®æ·»åŠ ä¸€ä¸ªä¸‹æ ‡ï¼š$z_{ij}$è¡¨ç¤ºä½å§¿å¤„$\xi_i$è§‚æµ‹è·¯æ ‡$p_i$äº§ç”Ÿçš„æ•°æ®ï¼Œæœ€åå°±å¾—åˆ°äº†éœ€è¦ä¼˜åŒ–çš„å‡½æ•°ï¼š  
$$
\frac{1}{2}\sum_{i=1}^{m}\sum_{j=1}^{n}||e_{ij}||^2=\frac{1}{2}\sum_{i=1}^{m}\sum_{j=1}^{n}||z_{ij}-h(\xi_i,p_j)||^2
$$   
### BAä¼˜åŒ–   
æ ¹æ®éçº¿æ€§ä¼˜åŒ–çš„æ€æƒ³ï¼Œæˆ‘ä»¬åº”è¯¥ä»æŸä¸ªçš„åˆå§‹å€¼å¼€å§‹ï¼Œä¸æ–­åœ°å¯»æ‰¾ä¸‹é™æ–¹å‘Î”x
æ¥æ‰¾åˆ°ç›®æ ‡å‡½æ•°çš„æœ€ä¼˜è§£ï¼Œå³ä¸æ–­åœ°æ±‚è§£å¢é‡æ–¹ç¨‹ä¸­çš„å¢é‡Î”xã€‚é¦–å…ˆéœ€è¦æŠŠæ‰€æœ‰è‡ªå˜é‡å®šä¹‰æˆå¾…ä¼˜åŒ–å˜é‡ï¼š$x=[\xi_1,...,\xi_m,p_1,...,p_n]^T$ï¼Œç›¸åº”çš„ï¼Œå¢é‡æ–¹ç¨‹ä¸­çš„Î”x
åˆ™æ˜¯å¯¹æ•´ä½“è‡ªå˜é‡çš„å¢é‡ã€‚åœ¨è¿™ä¸ªæ„ä¹‰ä¸‹ï¼Œå½“æˆ‘ä»¬ç»™è‡ªå˜é‡ä¸€ä¸ªå¢é‡æ—¶ï¼Œç›®æ ‡å‡½æ•°å˜ä¸ºï¼š  
$$
\frac{1}{2}\|f(\boldsymbol{x}+\Delta \boldsymbol{x})\|^{2} \approx \frac{1}{2} \sum_{i=1}^{m} \sum_{i=1}^{n}\left\|\boldsymbol{e}_{i j}+\boldsymbol{F}_{i j} \Delta \boldsymbol{\xi}_{i}+\boldsymbol{E}_{i j} \Delta \boldsymbol{p}_{j}\right\|^{2}
$$   
å…¶ä¸­$F_{ij}$ä»£ä»·å‡½æ•°å¯¹ç›¸å¯¹ä½å§¿çš„åå¯¼æ•°ï¼Œ$E_{ij}$è¡¨ç¤ºè¯¥å‡½æ•°å¯¹è·¯æ ‡ç‚¹ä½ç½®çš„åå¯¼ã€‚ æ— è®ºä½¿ç”¨é«˜æ–¯ç‰›é¡¿æ³•è¿˜æ˜¯åˆ—æ–‡ä¼¯æ ¼â€”é©¬å¤¸å°”ç‰¹æ–¹æ³•ï¼Œæœ€åéƒ½å°†é¢å¯¹å¢é‡çº¿æ€§æ–¹ç¨‹ï¼š$\boldsymbol{H} \Delta \boldsymbol{x}=\boldsymbol{g}$ï¼Œæ ¹æ®ç¬¬6è®²çš„çŸ¥è¯†ï¼Œé«˜æ–¯ç‰›é¡¿æ³•å’Œåˆ—æ–‡ä¼¯æ ¼â€”é©¬å¤¸å°”ç‰¹æ–¹æ³•çš„ä¸»è¦å·®åˆ«åœ¨äºï¼Œè¿™é‡Œçš„ $\boldsymbol H$ æ˜¯å– $\boldsymbol J^T\boldsymbol J$ è¿˜æ˜¯ $\boldsymbol J^T\boldsymbol J+\lambda \boldsymbol I$ çš„å½¢å¼ã€‚
ç”±äºæŠŠå˜é‡å½’ç±»æˆäº†ä½å§¿å’Œç©ºé—´ç‚¹ä¸¤ç§ï¼Œæ‰€ä»¥é›…å¯æ¯”çŸ©é˜µå¯ä»¥åˆ†å—ä¸ºï¼š  
$
\boldsymbol{J}=[\boldsymbol{F} \boldsymbol{E}]
$   
ä»¥é«˜æ–¯ç‰›é¡¿æ³•ä¸ºä¾‹ï¼Œåˆ™ $\boldsymbol H$ çŸ©é˜µä¸ºï¼š    
$
\boldsymbol{H}=\boldsymbol{J}^{\mathrm{T}} \boldsymbol{J}=\left[\begin{array}{ll}
\boldsymbol{F}^{\mathrm{T}} \boldsymbol{F} & \boldsymbol{F}^{\mathrm{T}} \boldsymbol{E} \\
\boldsymbol{E}^{\mathrm{T}} \boldsymbol{F} & \boldsymbol{E}^{\mathrm{T}} \boldsymbol{E}
\end{array}\right]
$   
#### ç¨€ç–æ€§å’Œè¾¹ç¼˜åŒ–    
$\boldsymbol H$ çŸ©é˜µçš„ç¨€ç–æ€§æ˜¯ç”±é›…å¯æ¯”çŸ©é˜µ $\boldsymbol J(\boldsymbol x)$ å¼•èµ·çš„ã€‚
è€ƒè™‘è¿™äº›ä»£ä»·å‡½æ•°å½“ä¸­çš„å…¶ä¸­ä¸€ä¸ª $\boldsymbol e_{ij}$
æ³¨æ„ï¼Œè¿™ä¸ªè¯¯å·®é¡¹åªæè¿°äº†åœ¨ $\boldsymbol T_i$ çœ‹åˆ° $\boldsymbol p_j$ è¿™ä»¶äº‹ï¼Œåªæ¶‰åŠç¬¬ $i$ ä¸ªç›¸æœºä½å§¿å’Œç¬¬ $j$ ä¸ªè·¯æ ‡ç‚¹ï¼Œå¯¹å…¶ä½™éƒ¨åˆ†çš„å˜é‡çš„å¯¼æ•°éƒ½ä¸º $0$ã€‚æ‰€ä»¥è¯¥è¯¯å·®é¡¹å¯¹åº”çš„é›…å¯æ¯”çŸ©é˜µæœ‰ä¸‹é¢çš„å½¢å¼ï¼š
$$
\boldsymbol{J}_{i j}(\boldsymbol{x})=\left(\mathbf{0}_{2 \times 6}, \ldots \boldsymbol{0}_{2 \times 6}, \frac{\partial \boldsymbol{e}_{i j}}{\partial \boldsymbol{T}_{i}}, \boldsymbol{0}_{2 \times 6}, \ldots \boldsymbol{0}_{2 \times 3}, \ldots \boldsymbol{0}_{2 \times 3}, \frac{\partial \boldsymbol{e}_{i j}}{\partial \boldsymbol{p}_{j}}, \boldsymbol{0}_{2 \times 3}, \ldots \boldsymbol{0}_{2 \times 3}\right)
$$

å…¶ä¸­ $\mathbf{0}_{2 \times 6}$ è¡¨ç¤ºç»´åº¦ä¸º $2Ã—6$ çš„ $\mathbf 0$ çŸ©é˜µï¼ŒåŒç†ï¼Œ$\mathbf{0}_{2 \times 3}$ ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚
è¯¥è¯¯å·®é¡¹å¯¹ç›¸æœºå§¿æ€çš„åå¯¼ $\partial \boldsymbol{e}_{i j}/\partial \boldsymbol \xi_i$ ç»´åº¦ä¸º $2Ã—6$ï¼Œå¯¹è·¯æ ‡ç‚¹çš„åå¯¼ $\partial \boldsymbol{e}_{i j}/\partial \boldsymbol p_i$ ç»´åº¦æ˜¯ $2Ã—3$ã€‚
è¿™ä¸ªè¯¯å·®é¡¹çš„é›…å¯æ¯”çŸ©é˜µï¼Œé™¤äº†è¿™ä¸¤å¤„ä¸ºéé›¶å—ï¼Œå…¶ä½™åœ°æ–¹éƒ½ä¸ºé›¶ã€‚
è¿™ä½“ç°äº†è¯¥è¯¯å·®é¡¹ä¸å…¶ä»–è·¯æ ‡å’Œè½¨è¿¹æ— å…³çš„ç‰¹æ€§ã€‚
ä»å›¾ä¼˜åŒ–è§’åº¦æ¥è¯´ï¼Œè¿™æ¡è§‚æµ‹è¾¹åªå’Œä¸¤ä¸ªé¡¶ç‚¹æœ‰å…³ã€‚
ä»¥ä¸‹å›¾ä¸ºä¾‹ï¼Œè®¾ $\boldsymbol J_{ij}$ åªåœ¨ $i,j$ å¤„æœ‰éé›¶å—ï¼Œé‚£ä¹ˆå®ƒå¯¹ $\boldsymbol H$ çš„è´¡çŒ®ä¸º $\boldsymbol J^T_{ij}\boldsymbol J_{ij}$ï¼Œå…·æœ‰å›¾ä¸Šæ‰€ç”»çš„ç¨€ç–å½¢å¼ã€‚
![alt text](./orbslam_images/image-9.png) 
å¯¹Rè¿›è¡Œä¸€æ¬¡æ‰°åŠ¨$\triangle{R}$ï¼Œå‡è®¾å·¦æ‰°åŠ¨$\triangle{R}$å¯¹åº”çš„æä»£æ•°ä¸º
$$
\begin{aligned}
\frac{\partial ({\boldsymbol Rp})}{\partial {\boldsymbol \varphi}}
&= \lim_{\boldsymbol \varphi \to 0}
\frac{ \overbrace{ \exp ({\boldsymbol \varphi}^{\land})
}^{\color{Red}{å¯ä½œæ³°å‹’å±•å¼€}} \exp ({\boldsymbol \phi}^{\land})
{\boldsymbol p} - \exp ({\boldsymbol \phi}^{\land}) {\boldsymbol p}}
{ {\boldsymbol \varphi} }\\
&\approx \lim_{\boldsymbol \varphi \to 0}
\frac{({\boldsymbol I} + {\boldsymbol \varphi}^{\land}) \exp
({\boldsymbol \phi}^{\land}) {\boldsymbol p} - \exp ({\boldsymbol
\phi}^{\land}) {\boldsymbol p}}
{ {\boldsymbol \varphi} }  \\
&= \lim_{\boldsymbol \varphi \to 0}
\frac{ {\boldsymbol \varphi}^{\land} {\boldsymbol {Rp}} }
{ {\boldsymbol \varphi} }  \\
&= \lim_{\boldsymbol \varphi \to 0}
\frac{ -({\boldsymbol {Rp}})^{\land} {\boldsymbol \varphi} }
{ {\boldsymbol \varphi} } \\
&= -({\boldsymbol {Rp}})^{\land}
\end{aligned}
$$   
å‡è®¾ç©ºé—´ç‚¹pç»è¿‡ä¸€æ¬¡å˜æ¢Tï¼ˆå¯¹åº”çš„æä»£æ•°ä¸º$\xi$ï¼‰åå˜ä¸º Tpã€‚å½“ç»™å·¦ä¹˜ä¸€ä¸ªæ‰°åŠ¨$\Delta {\boldsymbol
T} = \exp (\delta {\boldsymbol
\xi}^{\land})$ï¼Œè®¾æ‰°åŠ¨é¡¹çš„æä»£æ•°ä¸º$\delta {\boldsymbol \xi} = [\delta {\boldsymbol
\rho}, \delta {\boldsymbol \phi}]^{T}$ï¼Œæœ‰
$$
\begin{aligned}
\frac{\partial ({\boldsymbol {Tp}})}{\partial \delta{\boldsymbol \xi}}
&= \lim_{\delta{\boldsymbol \xi} \to 0}
\frac{ \overbrace{ \exp (\delta {\boldsymbol \xi}^{\land})
}^{\color{Red}{å¯ä½œæ³°å‹’å±•å¼€}}  \exp ({\boldsymbol \xi}^{\land})
{\boldsymbol p} - \exp ({\boldsymbol \xi}^{\land}) {\boldsymbol p}}
{ \delta {\boldsymbol \xi} } \\
&\approx \lim_{\delta{\boldsymbol \xi} \to 0}
\frac{ ({\boldsymbol I} + \delta {\boldsymbol \xi}^{\land}) \exp
({\boldsymbol \xi}^{\land}) {\boldsymbol p} - \exp ({\boldsymbol
\xi}^{\land}) {\boldsymbol p} }
{ \delta {\boldsymbol \xi} } \\
&= \lim_{\delta{\boldsymbol \xi} \to 0}
\frac{  \delta {\boldsymbol \xi}^{\land} \exp ({\boldsymbol
\xi}^{\land}) {\boldsymbol p}  }
{ \delta {\boldsymbol \xi} } \\
&= \lim_{\delta{\boldsymbol \xi} \to 0}
\frac{
\begin{bmatrix}
\delta {\boldsymbol \phi}^{\land}  &   \delta {\boldsymbol
\rho}     \\
     {\boldsymbol
0}^{T}                 &                      1                           \\
\end{bmatrix}
\begin{bmatrix}
   {\boldsymbol {Rp}} +  {\boldsymbol t}     \\
                                     1                                \\
\end{bmatrix}
}
{ \delta {\boldsymbol \xi} } \\
&= \lim_{\delta{\boldsymbol \xi} \to 0}
\frac{
\begin{bmatrix}
   \delta {\boldsymbol \phi}^{\land} ({\boldsymbol {Rp}} + {\boldsymbol
t}) + \delta {\boldsymbol \rho}     \\
                                     0                                \\
\end{bmatrix}
}
{ \delta {\boldsymbol \xi} } \\
&=
\overbrace{
\begin{bmatrix}
{\boldsymbol I}            &   -({\boldsymbol {Rp}} + {\boldsymbol
t})^{\land}    \\
{\boldsymbol 0}^{T}    &     {\boldsymbol 0}^{T}             \\
\end{bmatrix}
}^{\color{Red}{ä¸Šå¼åˆ†å—æ±‚å¯¼}}\\
&= ({\boldsymbol {Tp}})^{\bigodot}
\end{aligned}
$$   
ä¸Šå¼ä¸­è¿ç®—ç¬¦å·çš„å«ä¹‰$\bigodot$ï¼šå°†ä¸€ä¸ªé½æ¬¡åæ ‡çš„ç©ºé—´ç‚¹å˜æ¢æˆä¸€ä¸ª4*6çš„çŸ©é˜µã€‚   
![alt text](./orbslam_images/image-8.png)       
![alt text](./orbslam_images/image-17.png)   
å½“æŸä¸ªè¯¯å·®é¡¹ $\boldsymbol J$ å…·æœ‰ç¨€ç–æ€§æ—¶ï¼Œå®ƒå¯¹ $\boldsymbol H$ çš„è´¡çŒ®ä¹Ÿå…·æœ‰ç¨€ç–å½¢å¼ã€‚
è¿™ä¸ª $\boldsymbol J^T_{ij}\boldsymbol J_{ij}$ çŸ©é˜µä¹Ÿä»…æœ‰4ä¸ªéé›¶å—ï¼Œä½äº $(i,i),(i,j),(j,i),(j,j)$ã€‚
å¯¹äºæ•´ä½“çš„ $\boldsymbol H$ï¼Œæœ‰ï¼š

$$
\boldsymbol{H}=\sum_{i, j} \boldsymbol{J}_{i j}^{\mathrm{T}} \boldsymbol{J}_{i j}
$$

$i$ åœ¨æ‰€æœ‰ç›¸æœºä½å§¿ä¸­å–å€¼ï¼Œ$j$ åœ¨æ‰€æœ‰è·¯æ ‡ç‚¹ä¸­å–å€¼ã€‚æŠŠ $\boldsymbol H$ è¿›è¡Œåˆ†å—ï¼š

$$
\boldsymbol{H}=\left[\begin{array}{ll}
\boldsymbol{H}_{11} & \boldsymbol{H}_{12} \\
\boldsymbol{H}_{21} & \boldsymbol{H}_{22}
\end{array}\right]
$$

è¿™é‡Œï¼Œ$\boldsymbol H_{11}$ åªå’Œç›¸æœºä½å§¿æœ‰å…³ï¼Œè€Œ $\boldsymbol H_{22}$ åªå’Œè·¯æ ‡ç‚¹æœ‰å…³ã€‚
å½“éå† $i,j$ æ—¶ï¼Œä»¥ä¸‹äº‹å®æ€»æ˜¯æˆç«‹çš„ï¼š

ä¸ç®¡ $i,j$ æ€ä¹ˆå˜ï¼Œ$\boldsymbol H_{11}$ éƒ½æ˜¯å¯¹è§’é˜µï¼Œåªåœ¨ $\boldsymbol H_{i,i}$ å¤„æœ‰éé›¶å—ã€‚
åŒç†ï¼Œ$\boldsymbol H_{22}$ ä¹Ÿæ˜¯å¯¹è§’é˜µï¼Œåªåœ¨ $\boldsymbol H_{j,j}$ å¤„æœ‰éé›¶å—ã€‚
å¯¹äº $\boldsymbol H_{12}$ å’Œ $\boldsymbol H_{21}$ï¼Œå®ƒä»¬å¯èƒ½æ˜¯ç¨€ç–çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯ç¨ å¯†çš„ï¼Œè§†å…·ä½“çš„è§‚æµ‹æ•°æ®è€Œå®šã€‚

è¿™æ˜¾ç¤ºäº† $\boldsymbol H$ çš„ç¨€ç–ç»“æ„ã€‚
ä¸¾ä¸€ä¸ªå®ä¾‹æ¥ç›´è§‚åœ°è¯´æ˜å®ƒçš„æƒ…å†µã€‚
å‡è®¾ä¸€ä¸ªåœºæ™¯å†…æœ‰ $2$ ä¸ªç›¸æœºä½å§¿ $(\boldsymbol C_1,\boldsymbol C_2)$ å’Œ $6$ ä¸ªè·¯æ ‡ç‚¹ $(\boldsymbol P_1 ,\boldsymbol P_2, \boldsymbol P_3, \boldsymbol P_4, \boldsymbol P_5,\boldsymbol P_6)$ã€‚
è¿™äº›ç›¸æœºå’Œç‚¹äº‘æ‰€å¯¹åº”çš„å˜é‡ä¸º $\boldsymbol T_i,i= 1,2$ åŠ $\boldsymbol p_j,j= 1,\cdots,6$ã€‚
ç›¸æœº $\boldsymbol C_1$ è§‚æµ‹åˆ°è·¯æ ‡ç‚¹ $\boldsymbol P_1 ,\boldsymbol P_2, \boldsymbol P_3, \boldsymbol P_4$ï¼Œç›¸æœº $\boldsymbol C_2$ è§‚æµ‹åˆ°è·¯æ ‡ç‚¹ $\boldsymbol P_3, \boldsymbol P_4, \boldsymbol P_5,\boldsymbol P_6$ã€‚
æŠŠè¿™ä¸ªè¿‡ç¨‹ç”»æˆç¤ºæ„å›¾ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ç›¸æœºå’Œè·¯æ ‡ä»¥åœ†å½¢èŠ‚ç‚¹è¡¨ç¤ºã€‚å¦‚æœ $i$ ç›¸æœºèƒ½å¤Ÿè§‚æµ‹åˆ° $j$ ç‚¹ï¼Œå°±åœ¨å®ƒä»¬å¯¹åº”çš„èŠ‚ç‚¹è¿ä¸Šä¸€æ¡è¾¹ã€‚    
![alt text](./orbslam_images/image-10.png)    
å¯ä»¥æ¨å‡ºï¼Œåœºæ™¯ä¸‹çš„BAç›®æ ‡å‡½æ•°åº”ä¸ºï¼š

$$
\frac{1}{2}\left(\left\|\boldsymbol e_{11}\right\|^{2}+\left\|\boldsymbol e_{12}\right\|^{2}+\left\|\boldsymbol e_{13}\right\|^{2}+\left\|\boldsymbol e_{14}\right\|^{2}+\left\|\boldsymbol e_{23}\right\|^{2}+\left\|\boldsymbol e_{24}\right\|^{2}+\left\|\boldsymbol e_{25}\right\|^{2}+\left\|\boldsymbol e_{26}\right\|^{2}\right)
$$

è¿™é‡Œçš„ $\boldsymbol e_{i,j}$ ä½¿ç”¨ä¹‹å‰å®šä¹‰è¿‡çš„ä»£ä»·å‡½æ•°ï¼Œå³å¼ $\frac{1}{2} \sum_{i=1}^{m} \sum_{j=1}^{n}\left\|\boldsymbol{e}_{i j}\right\|^{2}=\frac{1}{2} \sum_{i=1}^{m} \sum_{j=1}^{n}\left\|\boldsymbol{z}_{i j}-h\left(\boldsymbol{T}_{i}, \boldsymbol{p}_{j}\right)\right\|^{2}$
ä»¥ $\boldsymbol e_{11}$ ä¸ºä¾‹ï¼Œå®ƒæè¿°äº†åœ¨ $\boldsymbol C_1$ çœ‹åˆ°äº† $\boldsymbol P_1$ è¿™ä»¶äº‹ï¼Œä¸å…¶ä»–çš„ç›¸æœºä½å§¿å’Œè·¯æ ‡æ— å…³ã€‚
ä»¤ $\boldsymbol J_{11}$ ä¸º $\boldsymbol e_{11}$ æ‰€å¯¹åº”çš„é›…å¯æ¯”çŸ©é˜µï¼Œä¸éš¾çœ‹å‡º $\boldsymbol e_{11}$ å¯¹ç›¸æœºå˜é‡ $\boldsymbol \xi_2$ å’Œè·¯æ ‡ç‚¹ $\boldsymbol p_2,\cdots,\boldsymbol p_6$ çš„åå¯¼éƒ½ä¸º $0$ã€‚
æŠŠæ‰€æœ‰å˜é‡ä»¥ $\boldsymbol x=(\boldsymbol \xi_1,\boldsymbol \xi_2,\boldsymbol p_1,\cdots,\boldsymbol p_6)^T$ çš„é¡ºåºæ‘†æ”¾ï¼Œåˆ™æœ‰ï¼š

$$
\boldsymbol{J}_{11}=\frac{\partial \boldsymbol{e}_{11}}{\partial \boldsymbol{x}}=\left(\frac{\partial \boldsymbol{e}_{11}}{\partial \boldsymbol{\xi}_{1}}, \mathbf{0}_{2 \times 6}, \frac{\partial \boldsymbol{e}_{11}}{\partial \boldsymbol{p}_{1}}, \mathbf{0}_{2 \times 3}, \mathbf{0}_{2 \times 3}, \mathbf{0}_{2 \times 3}, \mathbf{0}_{2 \times 3}, \mathbf{0}_{2 \times 3}\right)
$$

ä¸ºäº†æ–¹ä¾¿è¡¨ç¤ºç¨€ç–æ€§ï¼Œç”¨å¸¦æœ‰é¢œè‰²çš„æ–¹å—è¡¨ç¤ºçŸ©é˜µåœ¨è¯¥æ–¹å—å†…æœ‰æ•°å€¼ï¼Œå…¶ä½™æ²¡æœ‰é¢œè‰²çš„åŒºåŸŸè¡¨ç¤ºçŸ©é˜µåœ¨è¯¥å¤„æ•°å€¼éƒ½ä¸º $0$ã€‚é‚£ä¹ˆä¸Šé¢çš„ $\boldsymbol{J}_{11}$ åˆ™å¯ä»¥è¡¨ç¤ºæˆä¸‹å›¾æ‰€ç¤ºçš„å›¾æ¡ˆã€‚åŒç†ï¼Œå…¶ä»–çš„é›…å¯æ¯”çŸ©é˜µä¹Ÿä¼šæœ‰ç±»ä¼¼çš„ç¨€ç–å›¾æ¡ˆã€‚    
![alt text](./orbslam_images/image-11.png)      
$\boldsymbol{J}_{11}$ çŸ©é˜µçš„éé›¶å—åˆ†å¸ƒå›¾ã€‚ä¸Šæ–¹çš„æ ‡è®°è¡¨ç¤ºçŸ©é˜µè¯¥åˆ—æ‰€å¯¹åº”çš„å˜é‡ã€‚ç”±äºç›¸æœºå‚æ•°ç»´æ•°æ¯”ç‚¹äº‘å‚æ•°ç»´æ•°å¤§ï¼Œæ‰€ä»¥ $\boldsymbol C_1$ å¯¹åº”çš„çŸ©é˜µå—è¦æ¯” $\boldsymbol P_1$ å¯¹åº”çš„çŸ©é˜µå—å®½ã€‚
ä¸ºäº†å¾—åˆ°è¯¥ç›®æ ‡å‡½æ•°å¯¹åº”çš„é›…å¯æ¯”çŸ©é˜µï¼Œå°†è¿™äº› $\boldsymbol{J}_{ij}$ æŒ‰ç…§ä¸€å®šé¡ºåºåˆ—ä¸ºå‘é‡ï¼Œé‚£ä¹ˆæ•´ä½“é›…å¯æ¯”çŸ©é˜µåŠç›¸åº”çš„ $\boldsymbol H$ çŸ©é˜µçš„ç¨€ç–æƒ…å†µå°±å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚     
![alt text](./orbslam_images/image-12.png)   
ç°åœ¨è€ƒè™‘æ›´ä¸€èˆ¬çš„æƒ…å†µï¼Œå‡å¦‚æœ‰ $m$ ä¸ªç›¸æœºä½å§¿ï¼Œ$n$ ä¸ªè·¯æ ‡ç‚¹ã€‚
ç”±äºé€šå¸¸è·¯æ ‡çš„æ•°é‡è¿œè¿œå¤šäºç›¸æœºï¼Œäºæ˜¯æœ‰ $n\gg m$ã€‚
ç”±ä¸Šé¢çš„æ¨ç†å¯çŸ¥ï¼Œä¸€èˆ¬æƒ…å†µä¸‹çš„ $\boldsymbol H$ çŸ©é˜µå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å®ƒçš„å·¦ä¸Šè§’å—æ˜¾å¾—éå¸¸å°ï¼Œè€Œå³ä¸‹è§’çš„å¯¹è§’å—å æ®äº†å¤§é‡åœ°æ–¹ã€‚
![alt text](./orbslam_images/image-13.png)
é™¤æ­¤ä¹‹å¤–ï¼Œéå¯¹è§’éƒ¨åˆ†åˆ™åˆ†å¸ƒç€æ•£ä¹±çš„è§‚æµ‹æ•°æ®ã€‚ç”±äºå®ƒçš„å½¢çŠ¶å¾ˆåƒç®­å¤´ï¼Œåˆç§°ä¸ºç®­å¤´å½¢ï¼ˆArrow-likeï¼‰çŸ©é˜µã€‚
å¯¹äºå…·æœ‰è¿™ç§ç¨€ç–ç»“æ„çš„ $\boldsymbol H$ï¼Œçº¿æ€§æ–¹ç¨‹ $\boldsymbol{H} \Delta \boldsymbol{x}=\boldsymbol{g}$ çš„æ±‚è§£åœ¨ç°å®å½“ä¸­å­˜åœ¨ç€è‹¥å¹²ç§åˆ©ç”¨ $\boldsymbol H$ çš„ç¨€ç–æ€§åŠ é€Ÿè®¡ç®—çš„æ–¹æ³•ã€‚
æœ¬èŠ‚ä»‹ç»è§†è§‰SLAMé‡Œä¸€ç§æœ€å¸¸ç”¨çš„æ‰‹æ®µï¼šSchur æ¶ˆå…ƒã€‚åœ¨SLAMç ”ç©¶ä¸­ä¹Ÿç§°ä¸ºMarginalizationï¼ˆè¾¹ç¼˜åŒ–ï¼‰ã€‚
ä»”ç»†è§‚å¯Ÿä¸Šå›¾ï¼Œå‘ç°è¿™ä¸ªçŸ©é˜µå¯ä»¥åˆ†æˆ $4$ ä¸ªå—ï¼Œå’Œå¼ $\boldsymbol{H}=\left[\begin{array}{ll}
\boldsymbol{H}_{11} & \boldsymbol{H}_{12} \\
\boldsymbol{H}_{21} & \boldsymbol{H}_{22}
\end{array}\right]$ ä¸€è‡´ã€‚
å·¦ä¸Šè§’ä¸ºå¯¹è§’å—çŸ©é˜µï¼Œæ¯ä¸ªå¯¹è§’å—å…ƒç´ çš„ç»´åº¦ä¸ç›¸æœºä½å§¿çš„ç»´åº¦ç›¸åŒï¼Œä¸”æ˜¯ä¸€ä¸ªå¯¹è§’å—çŸ©é˜µã€‚
å³ä¸‹è§’ä¹Ÿæ˜¯å¯¹è§’å—çŸ©é˜µï¼Œæ¯ä¸ªå¯¹è§’å—çš„ç»´åº¦æ˜¯è·¯æ ‡çš„ç»´åº¦ã€‚
éå¯¹è§’å—çš„ç»“æ„ä¸å…·ä½“è§‚æµ‹æ•°æ®ç›¸å…³ã€‚
é¦–å…ˆå°†è¿™ä¸ªçŸ©é˜µæŒ‰ç…§ä¸‹å›¾æ‰€ç¤ºçš„æ–¹å¼åšåŒºåŸŸåˆ’åˆ†ï¼Œè¿™4ä¸ªåŒºåŸŸæ­£å¥½å¯¹åº”äº†å…¬å¼ $\boldsymbol{H}=\boldsymbol{J}^{\mathrm{T}} \boldsymbol{J}=\left[\begin{array}{ll}
\boldsymbol{F}^{\mathrm{T}} \boldsymbol{F} & \boldsymbol{F}^{\mathrm{T}} \boldsymbol{E} \\
\boldsymbol{E}^{\mathrm{T}} \boldsymbol{F} & \boldsymbol{E}^{\mathrm{T}} \boldsymbol{E}
\end{array}\right]$ ä¸­çš„ $4$ ä¸ªçŸ©é˜µå—ã€‚
![alt text](./orbslam_images/image-14.png)
ä¸ºäº†åç»­åˆ†ææ–¹ä¾¿ï¼Œè®°è¿™ $4$ ä¸ªå—ä¸º $\boldsymbol B,\boldsymbol E, \boldsymbol E^T ,\boldsymbol C$ã€‚
äºæ˜¯ï¼Œå¯¹åº”çš„çº¿æ€§æ–¹ç¨‹ç»„ä¹Ÿå¯ä»¥ç”± $\boldsymbol{H} \Delta \boldsymbol{x}=\boldsymbol{g}$ å˜ä¸ºå¦‚ä¸‹å½¢å¼ï¼š

$$
\left[\begin{array}{ll}
\boldsymbol{B} & \boldsymbol{E} \\
\boldsymbol{E}^{\mathrm{T}} & \boldsymbol{C}
\end{array}\right]\left[\begin{array}{l}
\Delta \boldsymbol{x}_{\mathrm{c}} \\
\Delta \boldsymbol{x}_{p}
\end{array}\right]=\left[\begin{array}{l}
\boldsymbol{v} \\
\boldsymbol{w}
\end{array}\right]
$$

å…¶ä¸­ $\boldsymbol B$ æ˜¯å¯¹è§’å—çŸ©é˜µï¼Œæ¯ä¸ªå¯¹è§’å—çš„ç»´åº¦å’Œç›¸æœºå‚æ•°çš„ç»´åº¦ç›¸åŒï¼Œå¯¹è§’å—çš„ä¸ªæ•°æ˜¯ç›¸æœºå˜é‡çš„ä¸ªæ•°ã€‚
ç”±äºè·¯æ ‡æ•°é‡ä¼šè¿œè¿œå¤§äºç›¸æœºå˜é‡ä¸ªæ•°ï¼Œæ‰€ä»¥ $\boldsymbol C$ å¾€å¾€ä¹Ÿè¿œå¤§äº $\boldsymbol B$ã€‚
ä¸‰ç»´ç©ºé—´ä¸­æ¯ä¸ªè·¯æ ‡ç‚¹ä¸ºä¸‰ç»´ï¼Œäºæ˜¯ $\boldsymbol C$ çŸ©é˜µä¸ºå¯¹è§’å—çŸ©é˜µï¼Œæ¯ä¸ªå—ä¸º $3Ã—3$ çŸ©é˜µã€‚
å¯¹è§’å—çŸ©é˜µæ±‚é€†çš„éš¾åº¦è¿œå°äºå¯¹ä¸€èˆ¬çŸ©é˜µçš„æ±‚é€†éš¾åº¦ï¼Œå› ä¸ºåªéœ€è¦å¯¹é‚£äº›å¯¹è§’çº¿çŸ©é˜µå—åˆ†åˆ«æ±‚é€†å³å¯ã€‚
è€ƒè™‘åˆ°è¿™ä¸ªç‰¹æ€§ï¼Œå¯¹çº¿æ€§æ–¹ç¨‹ç»„è¿›è¡Œé«˜æ–¯æ¶ˆå…ƒï¼Œç›®æ ‡æ˜¯æ¶ˆå»å³ä¸Šè§’çš„éå¯¹è§’éƒ¨åˆ† $\boldsymbol E$ï¼Œå¾—ï¼š

$$
\left[\begin{array}{cc}
\boldsymbol{I} & -\boldsymbol{E} \boldsymbol{C}^{-1} \\
\mathbf 0 & \boldsymbol{I}
\end{array}\right]\left[\begin{array}{cc}
\boldsymbol{B} & \boldsymbol{E} \\
\boldsymbol{E}^{\mathrm{T}} & \boldsymbol C
\end{array}\right]\left[\begin{array}{l}
\Delta \boldsymbol{x}_{\mathrm{c}} \\
\Delta \boldsymbol{x}_{p}
\end{array}\right]=\left[\begin{array}{cc}
\boldsymbol{I} & -\boldsymbol{E} \boldsymbol{C}^{-1} \\
\mathbf{0} & \boldsymbol{I}
\end{array}\right]\left[\begin{array}{l}
\boldsymbol{v} \\
\boldsymbol{w}
\end{array}\right]
$$

æ•´ç†å¾—ï¼š

$$
\left[\begin{array}{cc}
\boldsymbol{B}-\boldsymbol{E} \boldsymbol{C}^{-1} \boldsymbol{E}^{\mathrm{T}} & \mathbf 0 \\
\boldsymbol{E}^{\mathrm{T}} & \boldsymbol C
\end{array}\right]\left[\begin{array}{l}
\Delta \boldsymbol{x}_{\mathrm{c}} \\
\Delta \boldsymbol{x}_{p}
\end{array}\right]=\left[\begin{array}{c}
\boldsymbol{v}-\boldsymbol{E} \boldsymbol{C}^{-1} \boldsymbol{w} \\
\boldsymbol{w}
\end{array}\right]
$$

æ¶ˆå…ƒä¹‹åï¼Œæ–¹ç¨‹ç»„ç¬¬ä¸€è¡Œå˜æˆå’Œ $\Delta \boldsymbol{x}_p$ æ— å…³çš„é¡¹ã€‚
å•ç‹¬æŠŠå®ƒæ‹¿å‡ºæ¥ï¼Œå¾—åˆ°å…³äºä½å§¿éƒ¨åˆ†çš„å¢é‡æ–¹ç¨‹ï¼š

$$
\left[\boldsymbol{B}-\boldsymbol{E} \boldsymbol{C}^{-1} \boldsymbol{E}^{T}\right] \Delta \boldsymbol{x}_{\mathrm{c}}=\boldsymbol{v}-\boldsymbol{E} \boldsymbol{C}^{-1} \boldsymbol{w}
$$

è¿™ä¸ªçº¿æ€§æ–¹ç¨‹çš„ç»´åº¦å’Œ $\boldsymbol B$ çŸ©é˜µä¸€æ ·ã€‚
å…ˆæ±‚è§£è¿™ä¸ªæ–¹ç¨‹ï¼Œç„¶åæŠŠè§£å¾—çš„ $\Delta \boldsymbol{x}_c$ ä»£å…¥åŸæ–¹ç¨‹ï¼Œæ±‚è§£ $\Delta \boldsymbol{x}_p$
è¿™ä¸ªè¿‡ç¨‹ç§°ä¸º Marginalizationï¼Œæˆ–è€… Schur æ¶ˆå…ƒï¼ˆSchur Eliminationï¼‰
ç›¸æ¯”äºç›´æ¥è§£çº¿æ€§æ–¹ç¨‹çš„åšæ³•ã€å®ƒçš„ä¼˜åŠ¿åœ¨äºï¼š

åœ¨æ¶ˆå…ƒè¿‡ç¨‹ä¸­ï¼Œç”±äº $\boldsymbol C$ ä¸ºå¯¹è§’å—ï¼Œæ‰€ä»¥ $\boldsymbol C^{-1}$ å®¹æ˜“è§£å‡º
æ±‚è§£äº† $\Delta \boldsymbol{x}_c$ ä¹‹åï¼Œè·¯æ ‡éƒ¨åˆ†çš„å¢é‡æ–¹ç¨‹ç”± $\Delta \boldsymbol{x}_{p}=\boldsymbol{C}^{-1}\left(\boldsymbol{w}-\boldsymbol{E}^{\mathrm{T}} \Delta \boldsymbol{x}_{\mathrm{c}}\right)$ ç»™å‡ºã€‚è¿™ä¾ç„¶ç”¨åˆ°äº† $\boldsymbol C^{-1}$ æ˜“äºæ±‚è§£çš„ç‰¹æ€§ã€‚

äºæ˜¯ï¼Œè¾¹ç¼˜åŒ–çš„ä¸»è¦è®¡ç®—é‡åœ¨äºæ±‚è§£å¼ $\left[\boldsymbol{B}-\boldsymbol{E} \boldsymbol{C}^{-1} \boldsymbol{E}^{T}\right] \Delta \boldsymbol{x}_{\mathrm{c}}=\boldsymbol{v}-\boldsymbol{E} \boldsymbol{C}^{-1} \boldsymbol{w}$
å°†æ­¤æ–¹ç¨‹çš„ç³»æ•°è®°ä¸º $\boldsymbol S$ï¼Œå®ƒçš„ç¨€ç–æ€§å¼ä¸è§„åˆ™çš„ï¼Œä¸‹å›¾æ˜¾ç¤ºäº†å¯¹ $\boldsymbol H$ çŸ©é˜µè¿›è¡Œ Schur æ¶ˆå…ƒåçš„ä¸€ä¸ª $\boldsymbol S$ å®ä¾‹ã€‚
![alt text](./orbslam_images/image-15.png)
$\boldsymbol H$ çŸ©é˜µçš„éå¯¹è§’å—å¤„çš„éé›¶å…ƒç´ å¯¹åº”ç€ç›¸æœºå’Œè·¯æ ‡çš„å…³è”ã€‚
è¿›è¡Œäº† Schur æ¶ˆå…ƒå $\boldsymbol S$ çš„ç¨€ç–æ€§ä¹Ÿå…·æœ‰ç‰©ç†æ„ä¹‰ï¼š$\boldsymbol S$ çŸ©é˜µçš„éå¯¹è§’çº¿ä¸Šçš„éé›¶çŸ©é˜µå—ï¼Œè¡¨ç¤ºäº†è¯¥å¤„å¯¹åº”çš„ä¸¤ä¸ªç›¸æœºå˜é‡ä¹‹é—´å­˜åœ¨ç€å…±åŒè§‚æµ‹çš„è·¯æ ‡ç‚¹ï¼Œæœ‰æ—¶ç§°ä¸ºå…±è§†ï¼ˆCo-visibilityï¼‰ã€‚
åä¹‹ï¼Œå¦‚æœè¯¥å—ä¸ºé›¶ï¼Œåˆ™è¡¨ç¤ºè¿™ä¸¤ä¸ªç›¸æœºæ²¡æœ‰å…±åŒè§‚æµ‹ã€‚
äºæ˜¯ï¼Œ$\boldsymbol S$ çŸ©é˜µçš„ç¨€ç–æ€§ç»“æ„å½“å–å†³äºå®é™…è§‚æµ‹çš„ç»“æœï¼Œæ— æ³•æå‰é¢„çŸ¥ã€‚
åœ¨å®è·µä¸­ï¼Œä¾‹å¦‚ ORB-SLAM ä¸­çš„ Local Mapping ç¯èŠ‚ï¼Œåœ¨åšBAçš„æ—¶å€™åˆ»æ„é€‰æ‹©é‚£äº›å…·æœ‰å…±åŒè§‚æµ‹çš„å¸§ä½œä¸ºå…³é”®å¸§ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒSchur æ¶ˆå…ƒåå¾—åˆ°çš„ $\boldsymbol S$ å°±æ˜¯ç¨ å¯†çŸ©é˜µã€‚
ä¸è¿‡ï¼Œç”±äºè¿™ä¸ªæ¨¡å—å¹¶ä¸æ˜¯å®æ—¶æ‰§è¡Œï¼Œæ‰€ä»¥è¿™ç§åšæ³•ä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ã€‚
ä½†æ˜¯æœ‰å¦ä¸€äº›æ–¹æ³•ï¼Œä¾‹å¦‚ DSOã€OKVIS ç­‰ï¼Œå®ƒä»¬é‡‡ç”¨äº†æ»‘åŠ¨çª—å£ï¼ˆSliding Windowï¼‰æ–¹æ³•ã€‚è¿™ç±»æ–¹æ³•å¯¹æ¯ä¸€å¸§éƒ½è¦æ±‚åšä¸€æ¬¡BAæ¥é˜²æ­¢è¯¯å·®çš„ç´¯ç§¯ï¼Œå› æ­¤å®ƒä»¬ä¹Ÿå¿…é¡»é‡‡ç”¨ä¸€äº›æŠ€å·§æ¥ä¿æŒ $\boldsymbol S$ çŸ©é˜µçš„ç¨€ç–æ€§ã€‚
ä»æ¦‚ç‡è§’åº¦æ¥çœ‹ï¼Œç§°è¿™ä¸€æ­¥ä¸ºè¾¹ç¼˜åŒ–ï¼Œæ˜¯å› ä¸ºå®é™…ä¸ŠæŠŠæ±‚ $(\Delta \boldsymbol x_c,\Delta \boldsymbol x_p)$ çš„é—®é¢˜ï¼Œè½¬åŒ–æˆäº†å…ˆå›ºå®š $\Delta \boldsymbol x_p$ï¼Œæ±‚å‡º $\Delta \boldsymbol x_c$ï¼Œå†æ±‚ $\Delta \boldsymbol x_p$ çš„è¿‡ç¨‹ã€‚è¿™ä¸€æ­¥ç›¸å½“äºåšäº†æ¡ä»¶æ¦‚ç‡å±•å¼€ï¼š

$$
P\left(\boldsymbol{x}_{\mathrm{c}}, \boldsymbol{x}_{p}\right)=P\left(\boldsymbol{x}_{\mathrm{c}} \mid \boldsymbol{x}_{p}\right) P\left(\boldsymbol{x}_{p}\right),
$$

ç»“æœæ˜¯æ±‚å‡ºäº†å…³äº $\boldsymbol x_p$ çš„è¾¹ç¼˜åˆ†å¸ƒï¼Œæ•…ç§°è¾¹ç¼˜åŒ–ã€‚
åœ¨å‰é¢ä»‹ç»çš„è¾¹ç¼˜åŒ–è¿‡ç¨‹ä¸­ï¼Œå®é™…ä¸ŠæŠŠæ‰€æœ‰çš„è·¯æ ‡ç‚¹éƒ½ç»™è¾¹ç¼˜åŒ–äº†ã€‚
æ ¹æ®å®é™…æƒ…å†µï¼Œä¹Ÿèƒ½é€‰æ‹©ä¸€éƒ¨åˆ†è¿›è¡Œè¾¹ç¼˜åŒ–ã€‚
åŒæ—¶ï¼ŒSchur æ¶ˆå…ƒåªæ˜¯å®ç°è¾¹ç¼˜åŒ–çš„å…¶ä¸­ä¸€ç§æ–¹å¼ï¼ŒåŒæ ·å¯ä»¥ä½¿ç”¨ Cholesky åˆ†è§£è¿›è¡Œè¾¹ç¼˜åŒ–ã€‚
#### é²æ£’æ ¸å‡½æ•°
åœ¨å‰é¢çš„BAé—®é¢˜ä¸­ï¼Œå°†æœ€å°åŒ–è¯¯å·®é¡¹çš„äºŒèŒƒæ•°å¹³æ–¹å’Œä½œä¸ºç›®æ ‡å‡½æ•°ã€‚
è¿™ç§åšæ³•è™½ç„¶å¾ˆç›´è§‚ï¼Œä½†å­˜åœ¨ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ï¼šå¦‚æœå‡ºäºè¯¯åŒ¹é…ç­‰åŸå› ï¼ŒæŸä¸ªè¯¯å·®é¡¹ç»™çš„æ•°æ®æ˜¯é”™è¯¯çš„ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ
æˆ‘ä»¬æŠŠä¸€æ¡åŸæœ¬ä¸åº”è¯¥åŠ åˆ°å›¾ä¸­çš„è¾¹ç»™åŠ è¿›å»äº†ï¼Œç„¶è€Œä¼˜åŒ–ç®—æ³•å¹¶ä¸èƒ½è¾¨åˆ«å‡ºè¿™æ˜¯ä¸ªé”™è¯¯æ•°æ®ï¼Œå®ƒä¼šæŠŠæ‰€æœ‰çš„æ•°æ®éƒ½å½“ä½œè¯¯å·®æ¥å¤„ç†ã€‚
åœ¨ç®—æ³•çœ‹æ¥ï¼Œè¿™ç›¸å½“äºçªç„¶è§‚æµ‹åˆ°äº†ä¸€æ¬¡å¾ˆä¸å¯èƒ½äº§ç”Ÿçš„æ•°æ®ã€‚è¿™æ—¶ï¼Œåœ¨å›¾ä¼˜åŒ–ä¸­ä¼šæœ‰ä¸€æ¡è¯¯å·®å¾ˆå¤§çš„è¾¹ï¼Œå®ƒçš„æ¢¯åº¦ä¹Ÿå¾ˆå¤§ï¼Œæ„å‘³ç€è°ƒæ•´ä¸å®ƒç›¸å…³çš„å˜é‡ä¼šä½¿ç›®æ ‡å‡½æ•°ä¸‹é™æ›´å¤šã€‚
æ‰€ä»¥ï¼Œç®—æ³•å°†è¯•å›¾ä¼˜å…ˆè°ƒæ•´è¿™æ¡è¾¹æ‰€è¿æ¥çš„èŠ‚ç‚¹çš„ä¼°è®¡å€¼ï¼Œä½¿å®ƒä»¬é¡ºåº”è¿™æ¡è¾¹çš„æ— ç†è¦æ±‚ã€‚
ç”±äºè¿™æ¡è¾¹çš„è¯¯å·®çœŸçš„å¾ˆå¤§ï¼Œå¾€å¾€ä¼šæŠ¹å¹³å…¶ä»–æ­£ç¡®è¾¹çš„å½±å“ï¼Œä½¿ä¼˜åŒ–ç®—æ³•ä¸“æ³¨äºè°ƒæ•´ä¸€ä¸ªé”™è¯¯çš„å€¼ã€‚
è¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬å¸Œæœ›çœ‹åˆ°çš„ã€‚
å‡ºç°è¿™ç§é—®é¢˜çš„åŸå› æ˜¯ï¼Œå½“è¯¯å·®å¾ˆå¤§æ—¶ï¼ŒäºŒèŒƒæ•°å¢é•¿å¾—å¤ªå¿«ã€‚
äºæ˜¯å°±æœ‰äº†æ ¸å‡½æ•°çš„å­˜åœ¨ã€‚æ ¸å‡½æ•°ä¿è¯æ¯æ¡è¾¹çš„è¯¯å·®ä¸ä¼šå¤§å¾—æ²¡è¾¹è€Œæ©ç›–å…¶ä»–çš„è¾¹ã€‚
å…·ä½“çš„æ–¹å¼æ˜¯ï¼ŒæŠŠåŸå…ˆè¯¯å·®çš„äºŒèŒƒæ•°åº¦é‡æ›¿æ¢æˆä¸€ä¸ªå¢é•¿æ²¡æœ‰é‚£ä¹ˆå¿«çš„å‡½æ•°ï¼ŒåŒæ—¶ä¿è¯è‡ªå·±çš„å…‰æ»‘æ€§è´¨ï¼ˆä¸ç„¶æ— æ³•æ±‚å¯¼ï¼‰ã€‚å› ä¸ºå®ƒä»¬ä½¿å¾—æ•´ä¸ªä¼˜åŒ–ç»“æœæ›´ä¸ºç¨³å¥ï¼Œæ‰€ä»¥åˆå«å®ƒä»¬é²æ£’æ ¸å‡½æ•°ï¼ˆRobust Kernelï¼‰ã€‚
é²æ£’æ ¸å‡½æ•°æœ‰è®¸å¤šç§ï¼Œä¾‹å¦‚æœ€å¸¸ç”¨çš„ Huber æ ¸ï¼š

$$
H(e)=\left\{\begin{array}{ll}
\frac{1}{2} e^{2} & \text { å½“ }|e| \leqslant \delta, \\
\delta\left(|e|-\frac{1}{2} \delta\right) & \text { å…¶ä»– }
\end{array}\right.
$$

å½“è¯¯å·® $e$ å¤§äºæŸä¸ªé˜ˆå€¼ $\delta$ åï¼Œå‡½æ•°å¢é•¿ç”±äºŒæ¬¡å½¢å¼å˜æˆäº†ä¸€æ¬¡å½¢å¼ï¼Œç›¸å½“äºé™åˆ¶äº†æ¢¯åº¦çš„æœ€å¤§å€¼ã€‚
åŒæ—¶ï¼ŒHuber æ ¸å‡½æ•°åˆæ˜¯å…‰æ»‘çš„ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ±‚å¯¼ã€‚
ä¸‹å›¾æ˜¾ç¤ºäº† Huber æ ¸å‡½æ•°ä¸äºŒæ¬¡å‡½æ•°çš„å¯¹æ¯”ï¼Œå¯è§åœ¨è¯¯å·®è¾ƒå¤§æ—¶ Huber æ ¸å‡½æ•°å¢é•¿æ˜æ˜¾ä½äºäºŒæ¬¡å‡½æ•°ã€‚
![alt text](./orbslam_images/image-16.png)
é™¤äº† Huber æ ¸ï¼Œè¿˜æœ‰ Cauchy æ ¸ã€Tukey æ ¸ï¼Œç­‰ç­‰ï¼Œg2oå’ŒCereséƒ½æä¾›äº†ä¸€äº›æ ¸å‡½æ•°ã€‚
å®è·µä¸­ï¼Œå¤šæ•°è½¯ä»¶åº“å·²ç»å®ç°äº†ç»†èŠ‚æ“ä½œï¼Œè€Œéœ€è¦åšçš„ä¸»è¦æ˜¯æ„é€ BAé—®é¢˜ï¼Œè®¾ç½® Schur æ¶ˆå…ƒï¼Œç„¶åè°ƒç”¨ç¨ å¯†æˆ–è€…ç¨€ç–çŸ©é˜µæ±‚è§£å™¨å¯¹å˜é‡è¿›è¡Œä¼˜åŒ–ã€‚
#### ä¼˜åŒ–å®è·µ  
åœ¨è§†è§‰SLAMåå››è®²ä¹Ÿæœ‰å…·ä½“è¯´æ˜åŸºäºSE3çš„g2oç‰ˆæœ¬[pose_graph_g2o_SE3.cpp](../slambook/ch11/pose_graph_g2o_SE3.cpp)ï¼Œå½“æœºå™¨äººåœ¨æ›´å¤§èŒƒå›´çš„æ—¶é—´å’Œç©ºé—´ä¸­è¿åŠ¨æ—¶ï¼Œä»å‡å°è®¡ç®—é‡çš„è§’åº¦å‡ºå‘æœ‰ä¸€ä¸‹è§£å†³æ–¹æ¡ˆï¼š
a æ»‘åŠ¨çª—å£æ³•ï¼Œä¸¢å¼ƒä¸€äº›å†å²æ•°æ®ï¼›
b ä½å§¿å›¾ï¼Œèˆå¼ƒå¯¹è·¯æ ‡ç‚¹çš„ä¼˜åŒ–ï¼Œåªä¿ç•™ç›¸æœºä½å§¿ã€‚   
![alt text](./orbslam_images/image-18.png)  
æ„é€ æœ€ä¼˜åŒ–é—®é¢˜æ‰€æœ‰çš„ä½å§¿é¡¶ç‚¹å’Œä½å§¿-ä½å§¿è¾¹æ„æˆäº†ä¸€ä¸ªå›¾ä¼˜åŒ–ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæœ€å°äºŒä¹˜é—®é¢˜ï¼Œä¼˜åŒ–å˜é‡ä¸ºå„ä¸ªé¡¶ç‚¹çš„ä½å§¿ï¼Œè¾¹æ¥è‡ªäºä½å§¿è§‚æµ‹çº¦æŸã€‚ä¼˜åŒ–æ–¹æ³•å¯ä»¥é€‰ç”¨é«˜æ–¯ç‰›é¡¿æ³•ã€åˆ—æ–‡ä¼¯æ ¼-é©¬å¤¸å°”ç‰¹æ–¹æ³•ç­‰æ±‚è§£ã€‚      
ä½å§¿å›¾ä¼˜åŒ–â€”â€”g2oåŸç”Ÿä½å§¿å›¾å®ç°
3.1ï¼‰ æ•°æ®è¯´æ˜ï¼š
ä½å§¿å›¾æ•°æ®æ˜¯ç”±g2oè‡ªå¸¦çš„create sphere ç¨‹åºä»¿çœŸç”Ÿæˆçš„
çœŸå®è½¨è¿¹ä¸ºä¸€ä¸ªçƒä½“ï¼Œç”±ä»ä¸‹å¾€ä¸Šçš„å¤šä¸ªå±‚ç»„æˆ
ä»¿çœŸç¨‹åºç”Ÿæˆäº†t-1åˆ°tæ—¶åˆ»çš„è¾¹ï¼Œç§°ä¸ºodometryè¾¹ï¼ˆé‡Œç¨‹è®¡ï¼‰ï¼Œæ­¤å¤–ï¼Œåˆç”Ÿæˆäº†å±‚ä¸å±‚ä¹‹é—´çš„è¾¹ï¼Œç§°ä¸ºloop closure (å›ç¯)
åœ¨æ¯æ¡è¾¹ä¸Šæ·»åŠ å™ªå£°ï¼Œæ ¹æ®é‡Œç¨‹è®¡è¾¹çš„å™ªå£°ï¼Œé‡æ–°è®¾ç½®èŠ‚ç‚¹çš„åˆå§‹å€¼ï¼Œè¿™æ ·å°±ç”Ÿæˆäº†å¸¦æœ‰ç´¯è®¡è¯¯å·®çš„ä½å§¿å›¾æ•°æ®ã€‚
3.2ï¼‰ ä½å§¿å›¾ä¿¡æ¯è¯»å–
åŒ…æ‹¬å„ä¸ªä½å§¿ç‚¹çš„ä½å§¿ä¿¡æ¯ï¼›ï¼ˆID + å¹³ç§»å‘é‡+ å››å…ƒæ•°ï¼‰
ä¸¤ä¸¤ä½å§¿ç‚¹ä¹‹é—´çš„é‡æµ‹ä¿¡æ¯ä»¥åŠRé˜µä¿¡æ¯ï¼ˆå…¶ä¸­Ré˜µæ˜¯éå¯¹è§’çº¿å…ƒç´ æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ç»™çš„æ˜¯ä¸‰è§’é˜µï¼‰
3.3ï¼‰ å›¾ä¼˜åŒ–é—®é¢˜æ„å»º
æ±‚è§£å™¨çš„è®¾ç½®ï¼Œä¼˜åŒ–é—®é¢˜æ„å»º   
è¾¹çš„ç±»å‹é‡‡ç”¨g2o::EdgeSE3ï¼š
å…¶ä¸­éœ€è¦æ³¨æ„è¾¹ç±»å‹ä¸­ï¼š
computeError è¯¯å·®å‡½æ•°è®¡ç®—ï¼ˆä¸¤æµ‹çš„ä¸¤ä¸¤é¡¶ç‚¹çš„ä½å§¿å˜åŒ–å’Œå®é™…ä½å§¿å˜åŒ–çš„æ®‹å·®è®¡ç®—ï¼‰
linearizeOplusçº¿æ€§åŒ–å‡½æ•°å®ç°ï¼ˆé›…å…‹æ¯”çŸ©é˜µæ±‚è§£ï¼‰ï¼šcomputeEdgeSE3Gradientå‡½æ•°   
#### é«˜æ–¯ç‰›é¡¿æ³•   
1.æ„å»ºæœ€å°äºŒä¹˜é—®é¢˜ï¼š
$T^{*}=argmin\frac{1}{2} \displaystyle \sum^{n}_{i=1}||u_{i}-\frac{1}{s_{i}}KTP_{i}||^{2}_{2}$  
çº¿æ€§åŒ–ï¼š$e(x+\Delta x) \approx e(x) + J^{T}\Delta x$   
é«˜æ–¯çš„å¢é‡æ–¹ç¨‹ä¸ºï¼š$(\displaystyle \sum^{100}_{i=1} J_{i}(\sigma^{2})^{-1} J_{i}^{T})\Delta x_{k}=\displaystyle \sum^{100}_{i=1} -J_{i}(\sigma^{2})^{-1} e_{i}$   
$H\Delta x_{k}=b$   
2.æ±‚é›…å¯æ¯”çŸ©é˜µï¼š
1. ä½¿ç”¨éé½æ¬¡åæ ‡ï¼Œåƒç´ è¯¯å·®eæ˜¯2ç»´ï¼Œxä¸ºç›¸æœºä½å§¿æ˜¯6ç»´ï¼Œ$J^T$æ˜¯ä¸€ä¸ª2*6çš„çŸ©é˜µã€‚  
2. å°†På˜æ¢åˆ°ç›¸æœºåæ ‡ä¸‹ä¸º$P^{'}=[X^{'},Y^{'},Z^{'}]^{T}$,åˆ™$su=KP^{'}$ã€‚   
3. æ¶ˆå»så¾—ï¼š$v=f_{y}\frac{Y^{'}}{Z^{'}}+c_{y}$  
4. å¯¹Tå·¦ä¹˜æ‰°åŠ¨é‡$\delta \xi$ï¼Œè€ƒè™‘eçš„å˜åŒ–å…³äºæ‰°åŠ¨é‡çš„å¯¼æ•°ã€‚åˆ™$\frac{\partial e}{\partial \delta \xi}= \frac{\partial e}{\partial P^{'}} \frac{\partial P^{'}}{\partial \delta \xi}$ã€‚
5. å¾—å‡º$\frac{\partial e}{\partial P^{'}}-\left[ \begin{matrix} \frac{f_{x}}{Z^{'}} & 0 & -\frac{f_{x}X^{'}}{Z^{'2}} \\ 0 & \frac{f_{y}}{Z^{'}} & -\frac{f_{y}Y^{'}}{Z^{'2}} \end{matrix} \right]$  
6. ç”±æä»£æ•°å¾—å‡º$\frac{\partial (TP)}{\partial \delta \xi} = \left[ \begin{matrix} I & -P^{' \Lambda} \\ 0^{T} & 0^{T} \end{matrix} \right]$
7. åœ¨$P^{'}$å®šä¹‰ä¸­å–äº†å‰ä¸‰ç»´ï¼Œæ‰€ä»¥$\frac{\partial P^{'}}{\partial \delta \xi} = \left[ \begin{matrix} I & -P^{' \Lambda} \end{matrix} \right]$
8. ä¸¤ä¸ªå¼å­ç›¸ä¹˜å°±å¯ä»¥å¾—åˆ°é›…å¯æ¯”çŸ©é˜µï¼š
$\frac{\partial e}{\partial \delta \xi} = - \left[ \begin{matrix} \frac{f_{x}}{Z^{'}} & 0 & -\frac{f_{x}X^{'}}{Z^{'2}} & -\frac{f_{x}X^{'}Y^{'}}{Z^{'2}}  & f_{x} + \frac{f_{x}X^{'2}}{Z^{'2}} &- \frac{f_{x}Y^{'}}{Z^{'}} \\  0 & \frac{f_{y}}{Z^{'}} & -\frac{f_{y}Y^{'}}{Z^{'2}} & -f_{y} - \frac{f_{y}Y^{'2}}{Z^{'2}} & \frac{f_{y}X^{'}Y^{'}}{Z^{'2}} & \frac{f_{y}X^{'}}{Z^{'}} \end{matrix} \right]$
```C++ 
//G-Næ³•æ±‚è§£PnPé—®é¢˜
void solvePnPByGN(const vector<Eigen::Vector3d, Eigen::aligned_allocator<Eigen::Vector3d>> &ps3d, 
const vector<Eigen::Vector2d, Eigen::aligned_allocator<Eigen::Vector2d>> &ps2d, 
const Mat &k,
Sophus::SE3d &pose)
{
    const int iterations = 10;	//è¿­ä»£æ¬¡æ•°
    double cost = 0, lastCost = 0;	//ç›®æ ‡å‡½æ•°
    double fx = k.at<double>(0, 0);
    double cx = k.at<double>(0, 2);
    double fy = k.at<double>(1, 1);
    double cy = k.at<double>(1, 2);
        
    //å¼€å§‹è¿­ä»£æ±‚è§£
    for(int i = 0; i < iterations; i++)
    {
        Eigen::Matrix<double, 6, 6> H = Eigen::Matrix<double, 6, 6>::Zero();
        Eigen::Matrix<double, 6, 1> b = Eigen::Matrix<double, 6, 1>::Zero();

        //è®¡ç®—Jã€Hã€b
        cost = 0;
        for(int j = 0; j < (int)ps3d.size(); j++)
        {		
            Eigen::Vector3d tp3d = pose * ps3d[j];	//æ—‹è½¬åçš„ç©ºé—´åæ ‡
            Eigen::Vector2d tpNor2d(tp3d[0]/tp3d[2], tp3d[1]/tp3d[2]);	//æ—‹è½¬åç‚¹çš„å½’ä¸€åŒ–åæ ‡
            Eigen::Vector2d tp2d(fx*tpNor2d[0] + cx, fy*tpNor2d[1] + cy);	//æ—‹è½¬åç‚¹çš„åƒç´ åæ ‡

            Eigen::Vector2d e = ps2d[j] - tp2d;	//è¯¯å·®		
            cost += e.squaredNorm();
            
            Eigen::Matrix<double, 2, 6> J;
            double invZ = 1.0 / tp3d[2];
            double invZ2 = invZ * invZ;
            //Jæ˜¯2x6çŸ©é˜µ
            J << -fx * invZ, 0, fx * tp3d[0] * invZ2,
                fx * tp3d[0] * tp3d[1] * invZ2,	-fx - fx * tp3d[0] * tp3d[0] * invZ2, fx * tp3d[1] * invZ,
                0, -fy * invZ, fy * tp3d[1] * invZ2,
                fy + fy * tp3d[1] * tp3d[1] * invZ2, -fy * tp3d[0] * tp3d[1] * invZ2, -fy * tp3d[0] * invZ;

            H += J.transpose()*J;
            b += -J.transpose()*e;
        }

        //æ±‚è§£ Hx = b
        Eigen::Matrix<double, 6, 1> dx;
        dx = H.ldlt().solve(b);
        
        if(isnan(dx[0]))
        {
            cout << "isnan" << endl;
            break;
        }
        if(i > 0 && cost >= lastCost)
        {
            cout << "cost and last cost: " << cost << " " << lastCost << endl;
            break;
        }
        
        //æ›´æ–°ä¼˜åŒ–å˜é‡å’Œç›®æ ‡å‡½æ•°
        pose = Sophus::SE3d::exp(dx)*pose;
        lastCost = cost;
        
        cout << i << "\tcost: " << cost << endl;
        
        //dxè¶³å¤Ÿå°
        if(dx.norm() <= 1e-6)
        {
            cout << "converge" << endl;
            break;
        }
    }
}
```